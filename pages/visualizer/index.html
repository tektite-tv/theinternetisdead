<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Glitchcore Visualizer</title>
<style>
html,body{
  margin:0;padding:0;overflow:hidden;
  background:black;
  height:100%;
  font-family: monospace;
}
canvas{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  background:black;
  z-index:0;
}

#boom{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:220px;
  height:220px;
  border-radius:50%;
  border:6px solid rgba(255,255,255,.8);
  cursor:pointer;
  z-index:9999;
  background:conic-gradient(
    from 0deg,
    #ff0040,#ff8000,#ffff00,#00ff40,#00ffff,#0040ff,#8000ff,#ff00ff,#ff0040
  );
  box-shadow:
    0 0 20px #fff,
    0 0 40px #ff00ff,
    0 0 80px #00ffff;
  animation:spin 3s linear infinite,hue 4s linear infinite;
}
@keyframes spin{
  from{transform:translate(-50%,-50%) rotate(0deg);}
  to{transform:translate(-50%,-50%) rotate(360deg);}
}
@keyframes hue{
  from{filter:hue-rotate(0deg);}
  to{filter:hue-rotate(360deg);}
}
#boom:hover{
  transform:translate(-50%,-50%) scale(1.1) rotate(0deg);
  box-shadow:
    0 0 30px #fff,
    0 0 60px #ff00ff,
    0 0 100px #00ffff;
}

.glitch{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    0deg,
    rgba(255,0,255,0.04) 0 2px,
    rgba(0,255,255,0.04) 2px 4px
  );
  mix-blend-mode:screen;
  animation:flicker .1s infinite;
  pointer-events:none;
  z-index:1;
}
@keyframes flicker{
  0%{opacity:.6;transform:translate(0,0);}
  50%{opacity:.9;transform:translate(1px,-1px);}
  100%{opacity:.5;transform:translate(-1px,1px);}
}
.text{
  position:fixed;
  bottom:10%;
  width:100%;
  text-align:center;
  font-size:3em;
  color:#fff;
  text-shadow:0 0 20px magenta;
  letter-spacing:0.05em;
  animation:hue 5s linear infinite;
  z-index:2;
}
</style>
</head>
<body>
<button id="boom" title="INITIATE CHAOS"></button>
<canvas id="canvas"></canvas>
<div class="glitch"></div>
<div class="text" id="msg"></div>
<audio id="audio" src="/media/audio/do-that-there.mp3" crossorigin="anonymous"></audio>

<script>
const btn=document.getElementById('boom');
const audio=document.getElementById('audio');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const msg=document.getElementById('msg');
canvas.width=innerWidth;
canvas.height=innerHeight;
let audioCtx,src,analyser,dataArray,started=false;
let t=0;

function setup(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  src=audioCtx.createMediaElementSource(audio);
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=512;
  src.connect(analyser);
  analyser.connect(audioCtx.destination);
  dataArray=new Uint8Array(analyser.frequencyBinCount);
}

function draw(){
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(dataArray);
  const w=canvas.width,h=canvas.height;
  ctx.fillStyle='rgba(0,0,0,0.12)';
  ctx.fillRect(0,0,w,h);
  const bars=dataArray.length;
  const centerX=w/2,centerY=h/2;
  const timeFactor=Math.sin(t/50)*0.5+0.5;
  for(let i=0;i<bars;i++){
    const amp=dataArray[i];
    const ang=(i/bars)*Math.PI*2;
    const r=200+amp*1.2;
    const x=centerX+Math.cos(ang)*r;
    const y=centerY+Math.sin(ang)*r;
    const hue=(i*4+t)%360;
    ctx.strokeStyle=`hsl(${hue},100%,${50+timeFactor*50}%)`;
    ctx.beginPath();
    ctx.moveTo(centerX,centerY);
    ctx.lineTo(x,y);
    ctx.stroke();
    if(Math.random()<0.02){
      ctx.fillStyle=`hsl(${hue+120},100%,50%)`;
      ctx.fillRect(Math.random()*w,Math.random()*h,4+amp/20,4+amp/20);
    }
  }
  msg.textContent = ['GLITCH','VOID','ECHO','REPEAT'][Math.floor((t/30)%4)];
  t++;
}

btn.addEventListener('click',async()=>{
  if(started)return;
  started=true;
  btn.style.transition='opacity 0.5s ease';
  btn.style.opacity='0';
  setTimeout(()=>btn.remove(),600);

  msg.textContent='BOOTING GLITCHCORE...';
  setup();
  await audioCtx.resume();
  audio.play();
  setTimeout(()=>{msg.textContent='GLITCHCORE REACTOR ACTIVE';},2000);
  draw();
});

window.addEventListener('resize',()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
});
</script>
</body>
</html>
