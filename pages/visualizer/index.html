<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Glitchcore Visualizer â€“ Chaos Reactor</title>
<style>
html,body{
  margin:0;padding:0;overflow:hidden;
  background:black;height:100%;
  font-family: monospace;
}
canvas{
  position:fixed;
  inset:0;
  width:100%;
  height:100%;
  background:black;
  z-index:0;
  filter:contrast(1.3) brightness(1.2);
}
#boom{
  position:fixed;
  top:50%;
  left:50%;
  transform:translate(-50%,-50%);
  width:220px;
  height:220px;
  border-radius:50%;
  border:6px solid rgba(255,255,255,.8);
  cursor:pointer;
  z-index:9999;
  background:conic-gradient(
    from 0deg,
    #ff0040,#ff8000,#ffff00,#00ff40,#00ffff,#0040ff,#8000ff,#ff00ff,#ff0040
  );
  box-shadow:0 0 30px #fff,0 0 60px #ff00ff,0 0 120px #00ffff;
  animation:spin 3s linear infinite,hue 5s linear infinite;
}
@keyframes spin{
  from{transform:translate(-50%,-50%) rotate(0deg);}
  to{transform:translate(-50%,-50%) rotate(360deg);}
}
@keyframes hue{
  from{filter:hue-rotate(0deg);}
  to{filter:hue-rotate(360deg);}
}
#boom:hover{
  transform:translate(-50%,-50%) scale(1.1);
}
.glitch{
  position:fixed;
  inset:0;
  background:repeating-linear-gradient(
    0deg,
    rgba(255,0,255,0.04) 0 2px,
    rgba(0,255,255,0.04) 2px 4px
  );
  mix-blend-mode:screen;
  animation:flicker .1s infinite;
  pointer-events:none;
  z-index:1;
}
@keyframes flicker{
  0%{opacity:.6;transform:translate(0,0);}
  50%{opacity:.9;transform:translate(1px,-1px);}
  100%{opacity:.5;transform:translate(-1px,1px);}
}
.text{
  position:fixed;
  bottom:10%;
  width:100%;
  text-align:center;
  font-size:3em;
  color:#fff;
  text-shadow:0 0 20px magenta;
  letter-spacing:0.05em;
  animation:hue 5s linear infinite;
  z-index:2;
}
.flash {
  position:fixed;
  inset:0;
  background:white;
  opacity:0;
  mix-blend-mode:difference;
  z-index:10;
  pointer-events:none;
}
</style>
</head>
<body>
<button id="boom" title="INITIATE CHAOS"></button>
<canvas id="canvas"></canvas>
<div class="glitch"></div>
<div class="flash" id="flash"></div>
<div class="text" id="msg"></div>
<audio id="audio" src="/media/audio/do-that-there.mp3" crossorigin="anonymous"></audio>

<script>
const btn=document.getElementById('boom');
const audio=document.getElementById('audio');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const msg=document.getElementById('msg');
const flash=document.getElementById('flash');
canvas.width=innerWidth;
canvas.height=innerHeight;

let audioCtx,src,analyser,dataArray,started=false;
let t=0,lastKick=0,glitchAlpha=0,mode="idle";

function setup(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  src=audioCtx.createMediaElementSource(audio);
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=1024;
  src.connect(analyser);
  analyser.connect(audioCtx.destination);
  dataArray=new Uint8Array(analyser.frequencyBinCount);
}

function draw(){
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(dataArray);
  const w=canvas.width,h=canvas.height;
  const now=performance.now();

  // Frequency zones
  const bass=dataArray.slice(0,40).reduce((a,b)=>a+b,0)/40;
  const mids=dataArray.slice(40,120).reduce((a,b)=>a+b,0)/80;
  const highs=dataArray.slice(120).reduce((a,b)=>a+b,0)/(dataArray.length-120);
  const energy=(bass+mids+highs)/3;

  // detect beats
  if(bass>200 && now-lastKick>200){
    flash.style.opacity='0.8';
    flash.style.transition='opacity 0.15s ease';
    setTimeout(()=>flash.style.opacity='0',80);
    lastKick=now;
    glitchAlpha=Math.min(1,glitchAlpha+0.4);
  }
  glitchAlpha*=0.92;

  // pick mode
  if(bass>180 && mids<120) mode="BASS";
  else if(highs>180) mode="HIGH";
  else if(mids>150) mode="MID";
  else mode="DRIFT";

  // background smear
  ctx.fillStyle=`rgba(0,0,0,${mode==="HIGH"?0.05:0.12})`;
  ctx.fillRect(0,0,w,h);

  const bars=dataArray.length;
  const centerX=w/2,centerY=h/2;
  const pulse=(Math.sin(t/15)+1)*0.5;

  for(let i=0;i<bars;i++){
    const amp=dataArray[i];
    const ang=(i/bars)*Math.PI*2;
    const radius=200+amp*1.5+(mode==="DRIFT"?Math.sin(t/20+i)*40:0);
    const hue=(i*3+t*2)%360;
    const sat=mode==="BASS"?100:80;
    const light=mode==="HIGH"?70:50+pulse*30;
    ctx.strokeStyle=`hsl(${hue},${sat}%,${light}%)`;
    ctx.beginPath();
    ctx.moveTo(centerX,centerY);
    ctx.lineTo(centerX+Math.cos(ang)*radius,centerY+Math.sin(ang)*radius);
    ctx.stroke();
    if(Math.random()<glitchAlpha*0.1){
      ctx.fillStyle=`hsl(${hue+180},100%,60%)`;
      ctx.fillRect(Math.random()*w,Math.random()*h,8,8);
    }
  }

  // text mood
  const label = {
    "BASS":"PULSE",
    "MID":"DRIVE",
    "HIGH":"SHARD",
    "DRIFT":"ECHO"
  }[mode];
  msg.textContent=label;
  msg.style.textShadow=`0 0 20px hsl(${t*2%360},100%,50%)`;
  t++;
}

btn.addEventListener('click',async()=>{
  if(started)return;
  started=true;
  btn.style.transition='opacity 0.6s ease';
  btn.style.opacity='0';
  setTimeout(()=>btn.remove(),700);
  msg.textContent='BOOTING CHAOS...';
  setup();
  await audioCtx.resume();
  audio.play();
  setTimeout(()=>{msg.textContent='REACTOR ONLINE';},2000);
  draw();
});

window.addEventListener('resize',()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
});
</script>
</body>
</html>
