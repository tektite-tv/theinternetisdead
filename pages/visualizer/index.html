<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>RAINBOW MELTDOWN</title>
<style>
html,body{
  margin:0;padding:0;overflow:hidden;height:100%;
  background:black;font-family:monospace;
}
canvas{
  position:fixed;inset:0;width:100%;height:100%;
  z-index:0;image-rendering:pixelated;
}
.warning{
  position:fixed;
  left:50%;transform:translateX(-50%);
  color:#ff0000;background:rgba(0,0,0,0.8);
  font-weight:bold;font-size:1.4em;
  padding:10px 20px;border:2px solid #ff0000;border-radius:10px;
  z-index:5;text-align:center;text-shadow:0 0 10px #ff0000;
}
#topWarning{top:10%;}
#bottomWarning{bottom:10%;}
#boom{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:240px;height:240px;border-radius:50%;
  border:6px solid rgba(255,255,255,0.8);
  cursor:pointer;z-index:6;
  background:conic-gradient(from 0deg,
    red,orange,yellow,lime,cyan,blue,magenta,red);
  box-shadow:0 0 30px #fff,0 0 60px #ff00ff,0 0 120px #00ffff;
  animation:spin 3s linear infinite,hue 5s linear infinite;
}
@keyframes spin{
  from{transform:translate(-50%,-50%) rotate(0deg);}
  to{transform:translate(-50%,-50%) rotate(360deg);}
}
@keyframes hue{
  from{filter:hue-rotate(0deg);}
  to{filter:hue-rotate(360deg);}
}
.text{
  position: fixed;
  top: calc(55% + 180px); /* starts below button */
  width: 100%;
  text-align: center;
  font-size: 2.5em;
  color: white;
  text-shadow: 0 0 25px magenta, 0 0 40px cyan;
  letter-spacing: 0.1em;
  z-index: 4;
  pointer-events: none;
  transition: top 1.5s ease, font-size 1.5s ease;
}
</style>
</head>
<body>
<div id="topWarning" class="warning">
⚠ WARNING: The following animations may be dangerous to people with epilepsy. ⚠
</div>

<button id="boom"></button>

<div id="bottomWarning" class="warning">
⚠ VIEWER DISCRETION ADVISED — STRONG FLASHING LIGHTS AND COLORS ⚠
</div>

<canvas id="canvas"></canvas>
<div class="text" id="msg">INIT</div>
<audio id="audio" src="/media/audio/do-that-there.mp3" crossorigin="anonymous"></audio>

<script>
const btn=document.getElementById('boom');
const topWarn=document.getElementById('topWarning');
const bottomWarn=document.getElementById('bottomWarning');
const audio=document.getElementById('audio');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const msg=document.getElementById('msg');
canvas.width=innerWidth;canvas.height=innerHeight;

let audioCtx,src,analyser,dataArray,started=false;
let t=0, zoom=1, phase=0, rainbowShift=0;

function setup(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  src=audioCtx.createMediaElementSource(audio);
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=2048;
  src.connect(analyser);
  analyser.connect(audioCtx.destination);
  dataArray=new Uint8Array(analyser.frequencyBinCount);
}

function rand(a,b){return Math.random()*(b-a)+a;}

function draw(){
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(dataArray);
  const w=canvas.width,h=canvas.height;
  const cx=w/2,cy=h/2;

  const bass=dataArray.slice(0,60).reduce((a,b)=>a+b,0)/60;
  const mids=dataArray.slice(60,200).reduce((a,b)=>a+b,0)/140;
  const highs=dataArray.slice(200).reduce((a,b)=>a+b,0)/(dataArray.length-200);
  const energy=(bass+mids+highs)/3;

  ctx.fillStyle='rgba(0,0,0,0.07)';
  ctx.fillRect(0,0,w,h);

  ctx.save();
  zoom = 1 + 0.5*Math.sin(t/25) + (energy/255)*0.5;
  phase += (energy/500);
  rainbowShift += 2;

  ctx.translate(cx,cy);
  ctx.scale(zoom,zoom);
  ctx.rotate(Math.sin(t/200)*0.05);
  ctx.translate(-cx,-cy);

  // acid rainbow feedback
  ctx.globalCompositeOperation='lighter';
  ctx.filter=`hue-rotate(${rainbowShift}deg) saturate(2) blur(1px)`;
  ctx.drawImage(canvas, Math.sin(t/30)*3, Math.cos(t/33)*3, w, h);
  ctx.filter='none';
  ctx.globalCompositeOperation='source-over';

  const bars=dataArray.length;
  for(let i=0;i<bars;i++){
    const amp=dataArray[i];
    const angle=(i/bars)*Math.PI*2 + phase;
    const hue=(i*2 + rainbowShift)%360;
    const len=200 + Math.pow(amp,1.3);
    ctx.strokeStyle=`hsl(${hue},100%,${40+amp/6}%)`;
    ctx.lineWidth=1+amp/80;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.lineTo(cx+Math.cos(angle)*len,cy+Math.sin(angle)*len);
    ctx.stroke();
    if(Math.random()<0.002){
      ctx.fillStyle=`hsl(${(hue+180)%360},100%,70%)`;
      ctx.fillRect(rand(0,w),rand(0,h),rand(4,12),rand(4,12));
    }
  }

  ctx.restore();

  for(let i=0;i<40;i++){
    ctx.fillStyle=`hsl(${(rainbowShift+i*9)%360},100%,60%)`;
    ctx.fillRect(rand(0,w),rand(0,h),2,2);
  }

  const words=['ECHO','PULSE','DRIFT','VOID','BLOOM','HYPER','MELT','REALIGN'];
  msg.textContent=words[Math.floor((t/70)%words.length)];
  msg.style.textShadow=`0 0 25px hsl(${rainbowShift%360},100%,50%)`;
  t++;
}

btn.addEventListener('click',async()=>{
  if(started)return;
  started=true;
  btn.style.transition='opacity 0.6s ease';
  btn.style.opacity='0';
  topWarn.style.transition=bottomWarn.style.transition='opacity 0.8s ease';
  topWarn.style.opacity=bottomWarn.style.opacity='0';
  setTimeout(()=>{btn.remove();topWarn.remove();bottomWarn.remove();},900);
  msg.textContent='MELTING REALITY...';
  setup();
  await audioCtx.resume();
  audio.play();

  // drift the text upward after start
  setTimeout(()=>{
    msg.style.top='8%';
    msg.style.fontSize='3em';
  },2000);

  setTimeout(()=>{msg.textContent='RAINBOW SYNTHESIS';},1500);
  draw();
});

window.addEventListener('resize',()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
});
</script>
</body>
</html>
