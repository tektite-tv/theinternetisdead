<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>Glitchcore Reactor â€“ Breathing Mode</title>
<style>
html,body{
  margin:0;padding:0;overflow:hidden;
  height:100%;background:black;font-family:monospace;
}
canvas{
  position:fixed;inset:0;width:100%;height:100%;
  background:black;z-index:0;image-rendering:pixelated;
}
#boom{
  position:fixed;top:50%;left:50%;
  transform:translate(-50%,-50%);
  width:240px;height:240px;border-radius:50%;
  border:6px solid rgba(255,255,255,.9);
  cursor:pointer;z-index:9999;
  background:conic-gradient(from 0deg,
    #ff0040,#ff8000,#ffff00,#00ff40,#00ffff,#0040ff,#8000ff,#ff00ff,#ff0040);
  box-shadow:0 0 30px #fff,0 0 60px #ff00ff,0 0 100px #00ffff;
  animation:spin 3s linear infinite,hue 5s linear infinite;
}
@keyframes spin{from{transform:translate(-50%,-50%) rotate(0deg);}to{transform:translate(-50%,-50%) rotate(360deg);}}
@keyframes hue{from{filter:hue-rotate(0deg);}to{filter:hue-rotate(360deg);}}
.text{
  position:fixed;bottom:8%;width:100%;text-align:center;
  font-size:3em;color:white;text-shadow:0 0 25px magenta,0 0 40px cyan;
  letter-spacing:0.1em;z-index:10;
}
</style>
</head>
<body>
<button id="boom"></button>
<canvas id="canvas"></canvas>
<div class="text" id="msg"></div>
<audio id="audio" src="/media/audio/do-that-there.mp3" crossorigin="anonymous"></audio>

<script>
const btn=document.getElementById('boom');
const audio=document.getElementById('audio');
const canvas=document.getElementById('canvas');
const ctx=canvas.getContext('2d');
const msg=document.getElementById('msg');
canvas.width=innerWidth;canvas.height=innerHeight;

let audioCtx,src,analyser,dataArray,started=false;
let t=0,zoom=1;

function setup(){
  audioCtx=new (window.AudioContext||window.webkitAudioContext)();
  src=audioCtx.createMediaElementSource(audio);
  analyser=audioCtx.createAnalyser();
  analyser.fftSize=1024;
  src.connect(analyser);
  analyser.connect(audioCtx.destination);
  dataArray=new Uint8Array(analyser.frequencyBinCount);
}

function draw(){
  requestAnimationFrame(draw);
  analyser.getByteFrequencyData(dataArray);
  const w=canvas.width,h=canvas.height;
  const cx=w/2,cy=h/2;
  ctx.save();

  // --- calculate average energy ---
  const avg=dataArray.reduce((a,b)=>a+b,0)/dataArray.length;
  const bass=dataArray.slice(0,60).reduce((a,b)=>a+b,0)/60;
  const energy=(avg+bass*1.5)/255;

  // --- zoom factor based on energy ---
  zoom = 1 + energy*0.5*Math.sin(t/10);
  ctx.translate(cx,cy);
  ctx.scale(zoom,zoom);
  ctx.translate(-cx,-cy);

  // --- fading background ---
  ctx.fillStyle='rgba(0,0,0,0.15)';
  ctx.fillRect(0,0,w,h);

  // --- radial spectrum ---
  const bars=dataArray.length;
  for(let i=0;i<bars;i++){
    const amp=dataArray[i]/255;
    const ang=(i/bars)*Math.PI*2;
    const radius=200+amp*500;
    const hue=(t+i*2)%360;
    ctx.strokeStyle=`hsl(${hue},100%,${50+amp*50}%)`;
    ctx.lineWidth=1+amp*2;
    ctx.beginPath();
    ctx.moveTo(cx,cy);
    ctx.lineTo(cx+Math.cos(ang)*radius,cy+Math.sin(ang)*radius);
    ctx.stroke();
  }

  // --- minor pixel noise ---
  for(let i=0;i<40;i++){
    ctx.fillStyle=`hsl(${Math.random()*360},100%,60%)`;
    ctx.fillRect(Math.random()*w,Math.random()*h,2,2);
  }

  ctx.restore();

  const words=['PULSE','DRIFT','VOID','SHARD','BLOOM','ECHO'];
  msg.textContent=words[Math.floor((t/80)%words.length)];
  msg.style.textShadow=`0 0 25px hsl(${t%360},100%,50%)`;
  t++;
}

btn.addEventListener('click',async()=>{
  if(started)return;
  started=true;
  btn.style.transition='opacity 0.6s ease';
  btn.style.opacity='0';
  setTimeout(()=>btn.remove(),700);
  msg.textContent='INITIATING BREATH...';
  setup();
  await audioCtx.resume();
  audio.play();
  setTimeout(()=>{msg.textContent='SYNCHRONIZED';},1500);
  draw();
});

window.addEventListener('resize',()=>{
  canvas.width=innerWidth;
  canvas.height=innerHeight;
});
</script>
</body>
</html>
