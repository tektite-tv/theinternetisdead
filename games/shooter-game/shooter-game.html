<!doctype html>
<!--
  shooter-game.html v0.2.0
  Feature: Options menu and difficulty system
  - Re-added Options button to main menu
  - Difficulty slider (1=Easy, 2=Normal, 3=Hard)
  - Easy: half damage, Normal: unchanged, Hard: instant death
-->
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Bananaman Shooter</title>
<style>
html,body{margin:0;height:100%;background:#0b0b0b;color:#eaeaea;font-family:system-ui,sans-serif;overflow:hidden;}
#game-canvas{position:fixed;inset:0;width:100%;height:100%;display:block;}
.ui-layer{position:fixed;inset:0;pointer-events:none;}
.menu{pointer-events:auto;position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);
width:min(92vw,560px);background:rgba(20,20,20,0.92);border:1px solid rgba(255,255,255,0.08);
border-radius:16px;box-shadow:0 10px 40px rgba(0,0,0,0.55);padding:28px;text-align:center;}
.title{font-size:clamp(28px,4.5vw,48px);margin:0;color:#ffe066;text-shadow:0 2px 0 #5a4300;font-weight:800;}
.version{margin:4px 0 16px 0;font-size:.9rem;opacity:.7;}
.btn{pointer-events:auto;display:block;width:100%;margin:10px 0;padding:14px 16px;font-size:1rem;border-radius:12px;
border:1px solid rgba(255,255,255,0.12);background:linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.03));
color:#eaeaea;cursor:pointer;}
.hidden{display:none!important;}
.hud-tip{position:fixed;bottom:8px;right:12px;font-size:12px;opacity:.7;background:rgba(24,24,24,0.8);
border:1px solid rgba(255,255,255,0.06);padding:6px 8px;border-radius:8px;user-select:none;pointer-events:none;}
#hud-stats{position:fixed;top:10px;left:10px;font-size:14px;background:rgba(20,20,20,0.5);
padding:8px 12px;border-radius:8px;border:1px solid rgba(255,255,255,0.08);}
#healthbar{position:fixed;top:40px;left:10px;width:200px;height:20px;border:1px solid #fff;background:#330000;}
#healthfill{height:100%;width:100%;background:#ff3333;transition:width 0.2s;}
#healthtext{position:absolute;width:100%;text-align:center;font-size:12px;color:white;top:2px;}
#you-died{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;
font-size:64px;font-weight:900;color:#ff2222;text-shadow:0 0 20px #ff0000,0 0 40px #ff0000;
background:rgba(0,0,0,0.8);opacity:0;transition:opacity 1s;pointer-events:none;}
#you-died.show{opacity:1;}
/* Options Menu */
#options-menu p{margin:10px 0;}
input[type=range]{width:80%;}
</style>
</head>
<body>
<canvas id="game-canvas"></canvas>

<div class="ui-layer">
  <section id="main-menu" class="menu">
    <h1 class="title">Bananaman Shooter</h1>
    <p class="version">v0.2.0</p>
    <button id="btn-start" class="btn">Start Game</button>
    <button id="btn-options" class="btn">Options</button>
  </section>

  <section id="options-menu" class="menu hidden">
    <h2 class="title" style="font-size:2rem;">Options</h2>
    <p>Difficulty: <span id="diff-label">Normal</span></p>
    <input id="diff-slider" type="range" min="1" max="3" step="1" value="2">
    <p id="diff-desc">Enemies deal standard damage.</p>
    <button id="btn-back" class="btn">Back</button>
  </section>
</div>

<div id="hud-stats" class="hidden">Kills: <span id="killcount">0</span> | Wave: <span id="wavecount">0</span></div>
<div id="healthbar" class="hidden">
  <div id="healthfill"></div>
  <div id="healthtext">100%</div>
</div>
<div id="you-died">YOU DIED</div>
<div class="hud-tip">Move: WASD • Aim: Mouse • Shoot: Click/Space • ESC: Menu</div>

<script>
const canvas=document.getElementById('game-canvas');
const ctx=canvas.getContext('2d',{alpha:false});
const mainMenu=document.getElementById('main-menu');
const optionsMenu=document.getElementById('options-menu');
const btnStart=document.getElementById('btn-start');
const btnOptions=document.getElementById('btn-options');
const btnBack=document.getElementById('btn-back');
const diffSlider=document.getElementById('diff-slider');
const diffLabel=document.getElementById('diff-label');
const diffDesc=document.getElementById('diff-desc');
const hudStats=document.getElementById('hud-stats');
const killEl=document.getElementById('killcount');
const waveEl=document.getElementById('wavecount');
const healthBar=document.getElementById('healthbar');
const healthFill=document.getElementById('healthfill');
const healthText=document.getElementById('healthtext');
const deathScreen=document.getElementById('you-died');

const enemyGifs=[
 'bananarama.gif','dancing-guy.gif','dancingzoidberg.gif','dragon.gif','eyes.gif','fatspiderman.gif',
 'firework.gif','frog.gif','keyboard_smash.gif','skeleton.gif'
].map(n=>`/media/images/gifs/${n}`);

const State={
  screen:'menu',rafId:null,lastFrame:0,time:0,
  mouse:{x:innerWidth/2,y:innerHeight/2},
  player:{x:0,y:0,size:96,speed:280,hp:100,hitFlash:0},
  bananaImg:new Image(),bananaLoaded:false,
  keys:{},bullets:[],enemies:[],
  wave:0,kills:0,nextKillTarget:10,clearTimer:0,
  difficulty:2
};
State.bananaImg.src='/media/images/gifs/bananarama.gif';
State.bananaImg.onload=()=>State.bananaLoaded=true;

function fitCanvas(){
  const dpr=Math.min(devicePixelRatio||1,2);
  const w=Math.floor(innerWidth*dpr),h=Math.floor(innerHeight*dpr);
  canvas.width=w;canvas.height=h;canvas.style.width='100%';canvas.style.height='100%';
  ctx.setTransform(1,0,0,1,0,0);ctx.scale(dpr,dpr);
  State.player.x=innerWidth/2;State.player.y=innerHeight/2;
}
addEventListener('resize',fitCanvas);fitCanvas();

function drawBackground(){
  ctx.fillStyle='#0e0e10';ctx.fillRect(0,0,canvas.width,canvas.height);
  ctx.save();ctx.globalAlpha=.35;ctx.strokeStyle='#2aff8a';
  const s=32;
  for(let x=0;x<innerWidth;x+=s){ctx.beginPath();ctx.moveTo(x,0);ctx.lineTo(x,innerHeight);ctx.stroke();}
  for(let y=0;y<innerHeight;y+=s){ctx.beginPath();ctx.moveTo(0,y);ctx.lineTo(innerWidth,y);ctx.stroke();}
  ctx.restore();
}

function updatePlayer(dt){
  const p=State.player;
  if(State.keys['w'])p.y-=p.speed*dt;
  if(State.keys['s'])p.y+=p.speed*dt;
  if(State.keys['a'])p.x-=p.speed*dt;
  if(State.keys['d'])p.x+=p.speed*dt;
  p.x=Math.max(p.size/2,Math.min(innerWidth-p.size/2,p.x));
  p.y=Math.max(p.size/2,Math.min(innerHeight-p.size/2,p.y));
}

function drawPlayer(){
  const p=State.player;
  ctx.save();
  if(p.hitFlash>0){ctx.globalAlpha=0.5;ctx.filter='hue-rotate(0deg) brightness(200%) saturate(200%)';}
  if(State.bananaLoaded){ctx.drawImage(State.bananaImg,p.x-p.size/2,p.y-p.size/2,p.size,p.size);}
  else{ctx.fillStyle='#ffe066';ctx.beginPath();ctx.arc(p.x,p.y,p.size/2,0,Math.PI*2);ctx.fill();}
  ctx.restore();
}

function drawArrow(){
  const p=State.player,dx=State.mouse.x-p.x,dy=State.mouse.y-p.y,angle=Math.atan2(dy,dx);
  const r=p.size*0.4,ax=p.x+Math.cos(angle)*r,ay=p.y+Math.sin(angle)*r;
  ctx.save();ctx.translate(ax,ay);ctx.rotate(angle);
  ctx.fillStyle='#ff3333';ctx.shadowColor='#ff0000';ctx.shadowBlur=8;
  ctx.beginPath();ctx.moveTo(0,0);ctx.lineTo(-10,-4);ctx.lineTo(-10,4);ctx.closePath();ctx.fill();ctx.restore();
}

// Bullets
function shootBullet(){
  const p=State.player,dx=State.mouse.x-p.x,dy=State.mouse.y-p.y,a=Math.atan2(dy,dx),spd=700;
  State.bullets.push({x:p.x,y:p.y,vx:Math.cos(a)*spd,vy:Math.sin(a)*spd});
}
function updateBullets(dt){
  State.bullets.forEach(b=>{b.x+=b.vx*dt;b.y+=b.vy*dt;});
  State.bullets=State.bullets.filter(b=>b.x>0&&b.x<innerWidth&&b.y>0&&b.y<innerHeight);
}
function drawBullets(){
  ctx.fillStyle='#ff3333';
  for(const b of State.bullets){ctx.beginPath();ctx.arc(b.x,b.y,4,0,Math.PI*2);ctx.fill();}
}

// Enemies
function spawnWave(){
  State.wave++;
  waveEl.textContent=State.wave;
  const count=Math.min(5+State.wave*2,60);
  for(let i=0;i<count;i++){
    const side=Math.floor(Math.random()*4);
    let x,y;
    if(side===0){x=Math.random()*innerWidth;y=-60;}
    else if(side===1){x=innerWidth+60;y=Math.random()*innerHeight;}
    else if(side===2){x=Math.random()*innerWidth;y=innerHeight+60;}
    else{x=-60;y=Math.random()*innerHeight;}
    const img=new Image();img.src=enemyGifs[Math.floor(Math.random()*enemyGifs.length)];
    const size=40+Math.random()*80;
    const baseSpeed=50+State.wave*12;
    State.enemies.push({x,y,img,size,speed:baseSpeed+Math.random()*25,hitCooldown:0,pulse:0});
  }
  State.nextKillTarget+=10+State.wave*5;
}

function updateEnemies(dt){
  const p=State.player;
  for(const e of State.enemies){
    const dx=p.x-e.x,dy=p.y-e.y,dist=Math.hypot(dx,dy)||1;
    e.x+=dx/dist*e.speed*dt;
    e.y+=dy/dist*e.speed*dt;
    if(e.hitCooldown>0)e.hitCooldown-=dt;
    if(e.pulse>0)e.pulse-=dt*3;
  }
}

function drawEnemies(){
  for(const e of State.enemies){
    const pulseScale=1+(e.pulse||0)*0.3;
    if(e.img.complete)ctx.drawImage(e.img,e.x-e.size/2*pulseScale,e.y-e.size/2*pulseScale,e.size*pulseScale,e.size*pulseScale);
  }
}

// Collisions
function checkCollisions(dt){
  const p=State.player;
  // bullet vs enemy
  for(let i=State.enemies.length-1;i>=0;i--){
    const e=State.enemies[i];
    for(let j=State.bullets.length-1;j>=0;j--){
      const b=State.bullets[j];
      const dx=b.x-e.x,dy=b.y-e.y,dist=Math.hypot(dx,dy);
      if(dist<e.size/2+4){
        State.enemies.splice(i,1);
        State.bullets.splice(j,1);
        State.kills++;killEl.textContent=State.kills;
        if(State.kills>=State.nextKillTarget)spawnWave();
        break;
      }
    }
  }
  // enemy vs player
  for(const e of State.enemies){
    const dx=p.x-e.x,dy=p.y-e.y,dist=Math.hypot(dx,dy);
    if(dist<(p.size/2+e.size/2)*0.7 && e.hitCooldown<=0){
      e.hitCooldown=1;e.pulse=1;
      const roll=Math.floor(5+Math.random()*15)+State.wave;
      applyDamage(roll);
    }
  }
  if(State.enemies.length===0&&State.screen==='playing'){
    State.clearTimer+=dt;
    if(State.clearTimer>3){spawnWave();State.clearTimer=0;}
  } else State.clearTimer=0;
}

function applyDamage(dmg){
  const p=State.player;
  if(State.difficulty===1)dmg*=0.5; // easy
  if(State.difficulty===3)dmg=9999; // hard = death
  p.hp=Math.max(0,p.hp-dmg);
  p.hitFlash=0.3;
  updateHealthBar();
  if(p.hp<=0)die();
}

function updateHealthBar(){
  const p=State.player;
  const pct=Math.floor(p.hp);
  healthFill.style.width=pct+'%';
  healthText.textContent=pct+'%';
  if(pct<40)healthFill.style.background='#ff0000';
  else healthFill.style.background='#ff3333';
}

function die(){
  State.screen='dead';
  deathScreen.classList.add('show');
  cancelAnimationFrame(State.rafId);
}

// Loop
function loop(ts){
  const dt=State.lastFrame?(ts-State.lastFrame)/1000:0;
  State.lastFrame=ts;State.time+=dt;
  updatePlayer(dt);updateBullets(dt);updateEnemies(dt);checkCollisions(dt);
  const p=State.player;if(p.hitFlash>0)p.hitFlash-=dt;
  drawBackground();drawPlayer();drawArrow();drawBullets();drawEnemies();
  if(State.screen==='playing')State.rafId=requestAnimationFrame(loop);
}

function startGame(){
  mainMenu.classList.add('hidden');
  optionsMenu.classList.add('hidden');
  hudStats.classList.remove('hidden');
  healthBar.classList.remove('hidden');
  deathScreen.classList.remove('show');
  Object.assign(State,{
    screen:'playing',lastFrame:0,time:0,bullets:[],enemies:[],
    wave:0,kills:0,nextKillTarget:10,clearTimer:0,player:{...State.player,hp:100,hitFlash:0}
  });
  killEl.textContent='0';waveEl.textContent='0';updateHealthBar();spawnWave();
  if(!State.rafId)State.rafId=requestAnimationFrame(loop);
}

function returnToMenu(){
  if(State.rafId)cancelAnimationFrame(State.rafId);
  State.rafId=null;State.screen='menu';
  mainMenu.classList.remove('hidden');
  optionsMenu.classList.add('hidden');
  hudStats.classList.add('hidden');
  healthBar.classList.add('hidden');
}

btnStart.addEventListener('click',startGame);
btnOptions.addEventListener('click',()=>{
  mainMenu.classList.add('hidden');
  optionsMenu.classList.remove('hidden');
});
btnBack.addEventListener('click',()=>{
  optionsMenu.classList.add('hidden');
  mainMenu.classList.remove('hidden');
});

diffSlider.addEventListener('input',()=>{
  const val=parseInt(diffSlider.value);
  State.difficulty=val;
  if(val===1){diffLabel.textContent='Easy';diffDesc.textContent='Enemies deal half damage.';}
  if(val===2){diffLabel.textContent='Normal';diffDesc.textContent='Enemies deal standard damage.';}
  if(val===3){diffLabel.textContent='Hard';diffDesc.textContent='Enemies kill instantly.';}
});

addEventListener('keydown',e=>{
  State.keys[e.key.toLowerCase()]=true;
  if(e.key===' ')shootBullet();
  if(e.key==='Escape'&&State.screen==='playing')returnToMenu();
});
addEventListener('keyup',e=>State.keys[e.key.toLowerCase()]=false);
canvas.addEventListener('mousedown',shootBullet);
addEventListener('mousemove',e=>{State.mouse.x=e.clientX;State.mouse.y=e.clientY;});

drawBackground();mainMenu.classList.remove('hidden');
</script>
</body>
</html>
