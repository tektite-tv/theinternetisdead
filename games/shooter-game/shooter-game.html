<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Shooter Game v1.18</title>
<style>
html, body {
    margin: 0;
    padding: 0;
    background: black;
    color: white;
    overflow: hidden;
    font-family: monospace;
}
canvas {
    display: block;
    margin: 0 auto;
    background: black;
}
#waveBanner {
    position: absolute;
    top: 40%;
    width: 100%;
    text-align: center;
    font-size: 48px;
    color: rgba(0,255,0,0.8);
    pointer-events: none;
}
</style>
</head>
<body>
<div id="waveBanner"></div>
<canvas id="game"></canvas>

<script>
// ---- BASIC SETUP ----
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

const TOP_ZONE_RATIO = 0.45;
const PLAYER_Y = canvas.height * 0.85;

// ---- PLAYER ----
const player = {
    x: canvas.width / 2,
    y: PLAYER_Y,
    r: 15,
    lives: 5,
    invuln: 0
};

// ---- GAME STATE ----
let wave = 1;
let enemies = [];
let playerBullets = [];
let enemyBullets = [];
let fireCooldown = 0;

// ---- UI ----
const banner = document.getElementById("waveBanner");
function showWave() {
    banner.textContent = "WAVE " + wave;
    setTimeout(() => banner.textContent = "", 1200);
}

// ---- INPUT ----
const keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ---- HELPERS ----
function dist(a,b,c,d) {
    return Math.hypot(a-c,b-d);
}

// ---- SPAWN ENEMIES ----
function spawnWave() {
    enemies = [];
    const count = Math.min(2 ** (wave - 1), 128);
    const cols = Math.ceil(Math.sqrt(count));
    const rows = Math.ceil(count / cols);

    const zoneHeight = canvas.height * TOP_ZONE_RATIO;
    const spacingX = canvas.width / (cols + 1);
    const spacingY = zoneHeight / (rows + 1);
    const size = Math.min(spacingX, spacingY) * 0.35;

    let i = 0;
    for (let r = 0; r < rows; r++) {
        for (let c = 0; c < cols && i < count; c++) {
            enemies.push({
                x: spacingX * (c + 1),
                y: spacingY * (r + 1),
                r: size,
                dive: false,
                t: Math.random() * Math.PI * 2
            });
            i++;
        }
    }
    showWave();
}

// ---- SHOOTING ----
function shootPlayer() {
    if (fireCooldown <= 0) {
        playerBullets.push({x: player.x, y: player.y, vy: -8});
        fireCooldown = Math.max(10 - wave, 4);
    }
}

// ---- GAME LOOP ----
function update() {
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // Player move
    if (keys["ArrowLeft"]) player.x -= 6;
    if (keys["ArrowRight"]) player.x += 6;
    player.x = Math.max(player.r, Math.min(canvas.width - player.r, player.x));

    if (keys[" "] ) shootPlayer();
    if (fireCooldown > 0) fireCooldown--;

    // Update bullets
    playerBullets.forEach(b => b.y += b.vy);
    enemyBullets.forEach(b => b.y += b.vy);

    // Bullet vs bullet
    for (let i = playerBullets.length-1; i>=0; i--) {
        for (let j = enemyBullets.length-1; j>=0; j--) {
            if (dist(playerBullets[i].x, playerBullets[i].y,
                     enemyBullets[j].x, enemyBullets[j].y) < 6) {
                playerBullets.splice(i,1);
                enemyBullets.splice(j,1);
                break;
            }
        }
    }

    // Enemies
    enemies.forEach(e => {
        e.t += 0.02;
        e.x += Math.sin(e.t) * 0.6;
        if (Math.random() < 0.002 * wave) {
            enemyBullets.push({x: e.x, y: e.y, vy: 4 + wave});
        }
    });

    // Bullet vs enemy
    for (let i = playerBullets.length-1; i>=0; i--) {
        for (let j = enemies.length-1; j>=0; j--) {
            if (dist(playerBullets[i].x, playerBullets[i].y,
                     enemies[j].x, enemies[j].y) < enemies[j].r) {
                enemies.splice(j,1);
                playerBullets.splice(i,1);
                break;
            }
        }
    }

    // Enemy bullet vs player
    if (player.invuln > 0) player.invuln--;
    for (let i = enemyBullets.length-1; i>=0; i--) {
        if (dist(enemyBullets[i].x, enemyBullets[i].y, player.x, player.y) < player.r && player.invuln <= 0) {
            enemyBullets.splice(i,1);
            player.lives--;
            player.invuln = 60;
        }
    }

    // Draw player
    ctx.beginPath();
    ctx.arc(player.x, player.y, player.r, 0, Math.PI*2);
    ctx.fillStyle = player.invuln ? "yellow" : "white";
    ctx.fill();

    // Draw enemies
    enemies.forEach(e => {
        ctx.beginPath();
        ctx.arc(e.x, e.y, e.r, 0, Math.PI*2);
        ctx.fillStyle = "red";
        ctx.fill();
    });

    // Draw bullets
    ctx.fillStyle = "cyan";
    playerBullets.forEach(b => ctx.fillRect(b.x-2,b.y-6,4,6));
    ctx.fillStyle = "orange";
    enemyBullets.forEach(b => ctx.fillRect(b.x-2,b.y,4,6));

    // Next wave
    if (enemies.length === 0) {
        wave++;
        spawnWave();
    }

    requestAnimationFrame(update);
}

// ---- START ----
spawnWave();
update();
</script>
</body>
</html>
