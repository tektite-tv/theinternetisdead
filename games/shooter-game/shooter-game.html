<!doctype html>
<!--
  shooter-game.html v0.1.1
  Feature: Player sprite now uses /media/images/gifs/bananarama.gif
  - Added image preloading
  - Replaced yellow circle draw with banana image
  - Fallback to circle if image fails to load
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bananaman Shooter</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #0b0b0b;
      color: #eaeaea;
      font-family: system-ui, sans-serif;
    }
    #game-canvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
    .ui-layer {
      position: fixed;
      inset: 0;
      pointer-events: none;
    }
    .menu {
      pointer-events: auto;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(92vw, 560px);
      background: rgba(20,20,20,0.92);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.55);
      padding: 28px;
      text-align: center;
      backdrop-filter: blur(6px);
    }
    .title {
      font-size: clamp(28px, 4.5vw, 48px);
      margin: 0 0 8px 0;
      letter-spacing: 0.5px;
      font-weight: 800;
      color: #ffe066;
      text-shadow: 0 2px 0 #5a4300;
    }
    .btn {
      pointer-events: auto;
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 14px 16px;
      font-size: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: linear-gradient(180deg, rgba(255,255,255,0.06), rgba(255,255,255,0.03));
      color: #eaeaea;
      cursor: pointer;
    }
    .overlay {
      pointer-events: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.35);
      opacity: 0;
      visibility: hidden;
      transition: opacity 150ms ease;
    }
    .overlay.open {
      pointer-events: auto;
      opacity: 1;
      visibility: visible;
    }
    .options {
      pointer-events: auto;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      width: min(92vw, 560px);
      background: rgba(24,24,24,0.96);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.55);
      padding: 20px;
    }
    .hidden { display: none !important; }
    .hud-tip {
      position: fixed;
      bottom: 8px;
      right: 12px;
      font-size: 12px;
      opacity: 0.7;
      background: rgba(24,24,24,0.8);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 6px 8px;
      border-radius: 8px;
      user-select: none;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <canvas id="game-canvas"></canvas>

  <div class="ui-layer">
    <section id="main-menu" class="menu">
      <h1 class="title">Bananaman Shooter</h1>
      <button id="btn-start" class="btn">Start Game</button>
      <button id="btn-options" class="btn">Options</button>
    </section>

    <div id="options-overlay" class="overlay">
      <div class="options">
        <h2>Options</h2>
        <label for="opt-difficulty">Difficulty:</label>
        <select id="opt-difficulty">
          <option value="normal" selected>Normal</option>
          <option value="hard">Hard</option>
        </select>
        <div style="margin-top:10px;">
          <button id="opt-close" class="btn">Close</button>
          <button id="opt-apply" class="btn">Apply</button>
        </div>
      </div>
    </div>
  </div>

  <div class="hud-tip">ESC: Menu</div>

  <script>
  const canvas = document.getElementById('game-canvas');
  const ctx = canvas.getContext('2d', { alpha: false });

  const mainMenu = document.getElementById('main-menu');
  const btnStart = document.getElementById('btn-start');
  const btnOptions = document.getElementById('btn-options');
  const optionsOverlay = document.getElementById('options-overlay');
  const optClose = document.getElementById('opt-close');
  const optApply = document.getElementById('opt-apply');
  const optDifficulty = document.getElementById('opt-difficulty');

  const State = {
    screen: 'menu',
    rafId: null,
    lastFrame: 0,
    time: 0,
    player: { x: 0, y: 0, size: 64 },
    bananaImg: new Image(),
    bananaLoaded: false,
    bgStyle: 'grid'
  };

  // Load the banana sprite
  State.bananaImg.src = '/media/images/gifs/bananarama.gif';
  State.bananaImg.onload = () => State.bananaLoaded = true;
  State.bananaImg.onerror = () => console.warn('Banana image failed to load; using circle fallback.');

  function fitCanvas() {
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    const w = Math.floor(window.innerWidth * dpr);
    const h = Math.floor(window.innerHeight * dpr);
    canvas.width = w;
    canvas.height = h;
    canvas.style.width = '100%';
    canvas.style.height = '100%';
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(dpr, dpr);
    State.player.x = window.innerWidth / 2;
    State.player.y = window.innerHeight / 2;
  }
  window.addEventListener('resize', fitCanvas);
  fitCanvas();

  function drawBackground() {
    ctx.fillStyle = '#0e0e10';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
  }

  function drawPlayer() {
    if (State.bananaLoaded) {
      const s = State.player.size;
      ctx.drawImage(State.bananaImg, State.player.x - s/2, State.player.y - s/2, s, s);
    } else {
      ctx.fillStyle = '#ffe066';
      ctx.beginPath();
      ctx.arc(State.player.x, State.player.y, State.player.size/2, 0, Math.PI*2);
      ctx.fill();
    }
  }

  function loop(ts) {
    const dt = State.lastFrame ? (ts - State.lastFrame) / 1000 : 0;
    State.lastFrame = ts;
    State.time += dt;

    drawBackground();
    drawPlayer();

    if (State.screen === 'playing') {
      State.rafId = requestAnimationFrame(loop);
    }
  }

  function startGame() {
    mainMenu.classList.add('hidden');
    State.screen = 'playing';
    State.lastFrame = 0;
    if (!State.rafId) State.rafId = requestAnimationFrame(loop);
  }

  function returnToMenu() {
    if (State.rafId) cancelAnimationFrame(State.rafId);
    State.rafId = null;
    State.screen = 'menu';
    mainMenu.classList.remove('hidden');
  }

  function openOptions() {
    optionsOverlay.classList.add('open');
  }
  function closeOptions() {
    optionsOverlay.classList.remove('open');
  }
  function applyOptions() {
    State.difficulty = optDifficulty.value;
    closeOptions();
  }

  btnStart.addEventListener('click', startGame);
  btnOptions.addEventListener('click', openOptions);
  optClose.addEventListener('click', closeOptions);
  optApply.addEventListener('click', applyOptions);

  window.addEventListener('keydown', (e) => {
    if (e.key === 'Escape') {
      if (State.screen === 'playing') returnToMenu();
      else if (optionsOverlay.classList.contains('open')) closeOptions();
    }
  });

  drawBackground();
  mainMenu.classList.remove('hidden');
  </script>
</body>
</html>
