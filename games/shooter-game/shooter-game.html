<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>Galaga-ish Clone v1.12.2</title>
<style>
  html, body { margin:0; padding:0; background:black; overflow:hidden; color:#0f0; font-family:monospace; }
  canvas { display:block; }
  #overlay{
    position:absolute; top:10px; left:10px; font-size:14px; line-height:1.4; pointer-events:none;
    text-shadow:0 0 6px rgba(0,255,0,0.35);
  }
</style>
</head>
<body>
<canvas id="game"></canvas>
<div id="overlay"></div>

<script>
/* ======================================================================
  PROJECT CHANGELOG / REMOVAL LOG
========================================================================
[REMOVAL LOG]

- 2025-12-17 | v1.12.2
  Modified: Enemy spawn vertical position and player size.
  Reason: Enemies were spawning on top of the player at 100% zoom.
  Changes:
    - Player size increased (48 ‚Üí 72).
    - Enemy formation base Y raised.
    - Enforced minimum vertical padding between enemies and player.
  Location:
    - Player definition
    - spawnEnemies()
    - update() formation clamp
====================================================================== */

/* =======================
   Canvas + Globals
======================= */
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
const overlay = document.getElementById("overlay");

function resize(){
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
}
window.addEventListener("resize", resize);
resize();

let time = 0;

/* =======================
   Player
======================= */
const playerImg = new Image();
playerImg.src = "/media/images/gifs/bananarama.gif";

const player = {
  x: canvas.width / 2,
  y: canvas.height - 120,
  w: 72,                 // ‚¨ÖÔ∏è bigger player
  h: 72,
  speed: 6,
  invuln: 0
};

/* =======================
   Enemy Formation Layout
======================= */
const ENEMY_ROWS = 4;
const ENEMY_COLS = 6;

const BASE_SPACING_X = 95;
const BASE_SPACING_Y = 75;

const ENEMY_BASE_Y = 80;          // ‚¨ÖÔ∏è spawn higher
const MIN_PLAYER_PADDING = 140;   // ‚¨ÖÔ∏è guaranteed gap

let enemies = [];

const formation = {
  xOffset: 0,
  yOffset: 0,
  dir: 1,
  speed: 1.2,
  stepDown: 18,
  boundsPad: 40
};

function spawnEnemies(){
  enemies = [];
  for (let r = 0; r < ENEMY_ROWS; r++){
    for (let c = 0; c < ENEMY_COLS; c++){
      enemies.push({
        row: r,
        col: c,
        size: 56,
        x: 0, y: 0, w: 0, h: 0,
        img: playerImg
      });
    }
  }
}

/* =======================
   Update
======================= */
function update(dt){
  time += dt;

  const breath = Math.sin(time * 2) * 0.5 + 0.5;
  const spacingX = BASE_SPACING_X * (1 + breath * 0.35);
  const spacingY = BASE_SPACING_Y * (1 + breath * 0.15);

  const formationWidth = (ENEMY_COLS - 1) * spacingX;
  const startX = canvas.width/2 - formationWidth/2 + formation.xOffset;

  // Desired top Y
  let baseY = ENEMY_BASE_Y + formation.yOffset;

  // üîí Safety clamp: enemies may NEVER overlap the player
  const lowestEnemyY =
    baseY + (ENEMY_ROWS - 1) * spacingY + 56;

  const maxAllowedEnemyBottom =
    player.y - MIN_PLAYER_PADDING;

  if (lowestEnemyY > maxAllowedEnemyBottom){
    const correction = lowestEnemyY - maxAllowedEnemyBottom;
    formation.yOffset -= correction;
    baseY -= correction;
  }

  for (const e of enemies){
    const scale = 1 + breath * 0.25;
    const size = e.size * scale;

    e.x = startX + e.col * spacingX;
    e.y = baseY + e.row * spacingY;
    e.w = size;
    e.h = size;
  }
}

/* =======================
   Draw
======================= */
function draw(){
  ctx.fillStyle = "#000";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  // Player
  ctx.drawImage(
    playerImg,
    player.x - player.w/2,
    player.y - player.h/2,
    player.w,
    player.h
  );

  // Enemies
  for (const e of enemies){
    ctx.drawImage(
      e.img,
      e.x - e.w/2,
      e.y - e.h/2,
      e.w,
      e.h
    );
  }

  overlay.innerHTML =
    `Galaga-ish Clone v1.12.2<br>` +
    `Player size: ${player.w}px<br>` +
    `Enemy padding: ${MIN_PLAYER_PADDING}px`;
}

/* =======================
   Loop
======================= */
let lastT = performance.now();
function loop(t){
  const dt = Math.min(0.033, (t - lastT) / 1000);
  lastT = t;
  update(dt);
  draw();
  requestAnimationFrame(loop);
}

spawnEnemies();
requestAnimationFrame(loop);
</script>
</body>
</html>
