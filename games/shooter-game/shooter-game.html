<!doctype html>
<!--
  shooter-game.html v0.1.5
  Feature: Added red dot bullets
  Notes:
  - Click or press Space to fire
  - Bullets travel toward mouse aim direction
  - Auto-cleanup when off-screen
-->
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Bananaman Shooter</title>
  <style>
    html, body {
      height: 100%;
      margin: 0;
      background: #0b0b0b;
      color: #eaeaea;
      font-family: system-ui, sans-serif;
      overflow: hidden;
    }
    #game-canvas {
      position: fixed;
      inset: 0;
      width: 100%;
      height: 100%;
      display: block;
    }
    .ui-layer { position: fixed; inset: 0; pointer-events: none; }
    .menu {
      pointer-events: auto;
      position: absolute;
      top: 50%; left: 50%;
      transform: translate(-50%, -50%);
      width: min(92vw,560px);
      background: rgba(20,20,20,0.92);
      border: 1px solid rgba(255,255,255,0.08);
      border-radius: 16px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.55);
      padding: 28px;
      text-align: center;
      backdrop-filter: blur(6px);
    }
    .title {
      font-size: clamp(28px,4.5vw,48px);
      margin: 0 0 8px 0;
      color: #ffe066;
      text-shadow: 0 2px 0 #5a4300;
      font-weight: 800;
    }
    .btn {
      pointer-events: auto;
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 14px 16px;
      font-size: 1rem;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,0.12);
      background: linear-gradient(180deg,rgba(255,255,255,0.06),rgba(255,255,255,0.03));
      color: #eaeaea;
      cursor: pointer;
    }
    .hidden { display: none !important; }
    .hud-tip {
      position: fixed;
      bottom: 8px; right: 12px;
      font-size: 12px; opacity: 0.7;
      background: rgba(24,24,24,0.8);
      border: 1px solid rgba(255,255,255,0.06);
      padding: 6px 8px;
      border-radius: 8px;
      user-select: none; pointer-events: none;
    }
  </style>
</head>
<body>
  <canvas id="game-canvas"></canvas>

  <div class="ui-layer">
    <section id="main-menu" class="menu">
      <h1 class="title">Bananaman Shooter</h1>
      <button id="btn-start" class="btn">Start Game</button>
    </section>
  </div>

  <div class="hud-tip">Move: WASD • Aim: Mouse • Shoot: Click / Space • ESC: Menu</div>

  <script>
  const canvas = document.getElementById('game-canvas');
  const ctx = canvas.getContext('2d', { alpha: false });
  const mainMenu = document.getElementById('main-menu');
  const btnStart = document.getElementById('btn-start');

  const State = {
    screen: 'menu',
    rafId: null,
    lastFrame: 0,
    time: 0,
    mouse: { x: window.innerWidth/2, y: window.innerHeight/2 },
    player: { x: 0, y: 0, size: 96, speed: 280 },
    bananaImg: new Image(),
    bananaLoaded: false,
    keys: {},
    bullets: [],
  };

  State.bananaImg.src = '/media/images/gifs/bananarama.gif';
  State.bananaImg.onload = () => State.bananaLoaded = true;

  function fitCanvas() {
    const dpr = Math.min(window.devicePixelRatio || 1, 2);
    const w = Math.floor(window.innerWidth * dpr);
    const h = Math.floor(window.innerHeight * dpr);
    canvas.width = w;
    canvas.height = h;
    canvas.style.width = '100%';
    canvas.style.height = '100%';
    ctx.setTransform(1,0,0,1,0,0);
    ctx.scale(dpr, dpr);
    State.player.x = window.innerWidth / 2;
    State.player.y = window.innerHeight / 2;
  }
  window.addEventListener('resize', fitCanvas);
  fitCanvas();

  function drawBackground() {
    ctx.fillStyle = '#0e0e10';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.globalAlpha = 0.35;
    ctx.strokeStyle = '#2aff8a';
    const spacing = 32;
    for (let x = 0; x < window.innerWidth; x += spacing) {
      ctx.beginPath(); ctx.moveTo(x, 0); ctx.lineTo(x, window.innerHeight); ctx.stroke();
    }
    for (let y = 0; y < window.innerHeight; y += spacing) {
      ctx.beginPath(); ctx.moveTo(0, y); ctx.lineTo(window.innerWidth, y); ctx.stroke();
    }
    ctx.restore();
  }

  function updatePlayer(dt) {
    const p = State.player;
    if (State.keys['w']) p.y -= p.speed * dt;
    if (State.keys['s']) p.y += p.speed * dt;
    if (State.keys['a']) p.x -= p.speed * dt;
    if (State.keys['d']) p.x += p.speed * dt;
    p.x = Math.max(p.size/2, Math.min(window.innerWidth - p.size/2, p.x));
    p.y = Math.max(p.size/2, Math.min(window.innerHeight - p.size/2, p.y));
  }

  function drawPlayer() {
    const p = State.player;
    if (State.bananaLoaded) {
      ctx.drawImage(State.bananaImg, p.x - p.size/2, p.y - p.size/2, p.size, p.size);
    } else {
      ctx.fillStyle = '#ffe066';
      ctx.beginPath();
      ctx.arc(p.x, p.y, p.size/2, 0, Math.PI*2);
      ctx.fill();
    }
  }

  function drawArrow() {
    const p = State.player;
    const dx = State.mouse.x - p.x;
    const dy = State.mouse.y - p.y;
    const angle = Math.atan2(dy, dx);
    const orbitRadius = p.size * 0.5;
    const arrowX = p.x + Math.cos(angle) * orbitRadius;
    const arrowY = p.y + Math.sin(angle) * orbitRadius;

    ctx.save();
    ctx.translate(arrowX, arrowY);
    ctx.rotate(angle);
    ctx.fillStyle = '#ff3333';
    ctx.shadowColor = '#ff0000';
    ctx.shadowBlur = 8;
    ctx.beginPath();
    ctx.moveTo(0, 0);
    ctx.lineTo(-10, -4);
    ctx.lineTo(-10, 4);
    ctx.closePath();
    ctx.fill();
    ctx.restore();
  }

  // Bullet functions
  function shootBullet() {
    const p = State.player;
    const dx = State.mouse.x - p.x;
    const dy = State.mouse.y - p.y;
    const angle = Math.atan2(dy, dx);
    const speed = 600;
    const vx = Math.cos(angle) * speed;
    const vy = Math.sin(angle) * speed;
    State.bullets.push({ x: p.x, y: p.y, vx, vy });
  }

  function updateBullets(dt) {
    State.bullets.forEach(b => {
      b.x += b.vx * dt;
      b.y += b.vy * dt;
    });
    // remove offscreen
    State.bullets = State.bullets.filter(b =>
      b.x > 0 && b.x < window.innerWidth && b.y > 0 && b.y < window.innerHeight
    );
  }

  function drawBullets() {
    ctx.fillStyle = '#ff3333';
    for (const b of State.bullets) {
      ctx.beginPath();
      ctx.arc(b.x, b.y, 4, 0, Math.PI * 2);
      ctx.fill();
    }
  }

  function loop(ts) {
    const dt = State.lastFrame ? (ts - State.lastFrame) / 1000 : 0;
    State.lastFrame = ts;
    State.time += dt;

    updatePlayer(dt);
    updateBullets(dt);

    drawBackground();
    drawPlayer();
    drawArrow();
    drawBullets();

    if (State.screen === 'playing') {
      State.rafId = requestAnimationFrame(loop);
    }
  }

  function startGame() {
    mainMenu.classList.add('hidden');
    State.screen = 'playing';
    State.lastFrame = 0;
    if (!State.rafId) State.rafId = requestAnimationFrame(loop);
  }

  function returnToMenu() {
    if (State.rafId) cancelAnimationFrame(State.rafId);
    State.rafId = null;
    State.screen = 'menu';
    mainMenu.classList.remove('hidden');
  }

  btnStart.addEventListener('click', startGame);

  window.addEventListener('keydown', e => {
    State.keys[e.key.toLowerCase()] = true;
    if (e.key === ' ') shootBullet(); // space fires
    if (e.key === 'escape' && State.screen === 'playing') returnToMenu();
  });
  window.addEventListener('keyup', e => State.keys[e.key.toLowerCase()] = false);

  canvas.addEventListener('mousedown', shootBullet);

  window.addEventListener('mousemove', e => {
    State.mouse.x = e.clientX;
    State.mouse.y = e.clientY;
  });

  drawBackground();
  mainMenu.classList.remove('hidden');
  </script>
</body>
</html>
