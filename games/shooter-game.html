<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Outrun the Swarm</title>
<style>
  html,body{margin:0;overflow:hidden;background:#000;font-family:monospace;}
  canvas{display:block;}
  #hud{
    position:absolute;top:10px;left:10px;color:#0f0;
    text-shadow:1px 1px 3px #000;z-index:5;
  }
  #menu,#gameover{
    position:absolute;inset:0;display:flex;
    flex-direction:column;align-items:center;justify-content:center;
    background:rgba(0,0,0,0.9);z-index:10;
  }
  #menu h1,#gameover h1{font-size:48px;color:#0f0;margin-bottom:40px;}
  button{
    font-family:inherit;font-size:20px;
    background:#0f0;color:#000;border:none;
    padding:10px 30px;margin:10px;cursor:pointer;
    transition:background .2s;
  }
  button:hover{background:#8f8;}
  #gameover{display:none;}
  #stats{color:#0f0;margin-top:10px;}
</style>
</head>
<body>
<div id="hud">Time: 0s | Kills: 0</div>

<!-- Start Menu -->
<div id="menu">
  <h1>Outrun the Swarm</h1>
  <button id="startBtn">Start Game</button>
</div>

<!-- Game Over -->
<div id="gameover">
  <h1>YOU WERE DEVOURED</h1>
  <div id="stats"></div>
  <button id="restartBtn">Try Again</button>
</div>

<canvas id="game"></canvas>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
let w,h;function resize(){w=canvas.width=window.innerWidth;h=canvas.height=window.innerHeight;}
window.addEventListener("resize",resize);resize();

// Menus
const menu=document.getElementById("menu");
const gameover=document.getElementById("gameover");
const stats=document.getElementById("stats");
document.getElementById("startBtn").onclick=()=>{menu.style.display="none";startGame();};
document.getElementById("restartBtn").onclick=()=>{gameover.style.display="none";startGame();};

// ----------- GAME CONFIG ------------
const ARENA_W=4000, ARENA_H=4000;
const BASE_SPAWN_INTERVAL=100;
const SPAWN_ACCELERATION=0.97;
const BASE_ENEMY_SPEED=1.2;
const BOSS_TRIGGER_KILLS=40;

const GIF_PATH="/media/gifs/";
const ENEMY_GIFS=[
  "ghost.gif","bat.gif","slime.gif","skull.gif","zombie.gif",
  "evilbanana.gif","tiny_skelly.gif","weirdcat.gif","pumpkin.gif","face.gif"
];
const BOSS_GIF="180px-NO_U_cycle.gif";

let spawnInterval,enemySpeed,frames,running,startTime;
let bossSpawned=false;

const playerImg=new Image();playerImg.src=GIF_PATH+"bananarama.gif";
let player,bullets,enemies,camX,camY;

// preload enemy gifs
const enemyImages={};
for(const g of ENEMY_GIFS){
  const img=new Image();img.src=GIF_PATH+g;enemyImages[g]=img;
}
const bossImg=new Image();bossImg.src=GIF_PATH+BOSS_GIF;

function init(){
  player={x:ARENA_W/2,y:ARENA_H/2,r:24,speed:4,kills:0,alive:true};
  bullets=[];enemies=[];frames=0;camX=0;camY=0;
  spawnInterval=BASE_SPAWN_INTERVAL;
  enemySpeed=BASE_ENEMY_SPEED;
  startTime=performance.now();
  bossSpawned=false;
}

function startGame(){init();running=true;loop();}

// Input
const keys={};
window.addEventListener("keydown",e=>keys[e.key.toLowerCase()]=true);
window.addEventListener("keyup",e=>keys[e.key.toLowerCase()]=false);
canvas.addEventListener("click",shoot);
function shoot(e){
  if(!running||!player.alive)return;
  const rect=canvas.getBoundingClientRect();
  const mx=e.clientX-rect.left,my=e.clientY-rect.top;
  const angle=Math.atan2(my-h/2,mx-w/2);
  bullets.push({x:player.x,y:player.y,dx:Math.cos(angle)*10,dy:Math.sin(angle)*10});
}

// Random enemy spawn
function spawnEnemy(){
  const side=Math.floor(Math.random()*4);
  let x,y;
  if(side===0){x=Math.random()*ARENA_W;y=-100;}
  else if(side===1){x=ARENA_W+100;y=Math.random()*ARENA_H;}
  else if(side===2){x=Math.random()*ARENA_W;y=ARENA_H+100;}
  else{x=-100;y=Math.random()*ARENA_H;}

  // pick random gif
  const gifName=ENEMY_GIFS[Math.floor(Math.random()*ENEMY_GIFS.length)];
  const img=enemyImages[gifName];
  const size=20+Math.random()*60;
  const hp=Math.ceil(size/15);
  enemies.push({x,y,r:size/2,hp:hp,img:img,speed:enemySpeed*(0.8+Math.random()*0.4)});
}

// Boss spawn
function spawnBoss(){
  const side=Math.floor(Math.random()*4);
  let x,y;
  if(side===0){x=Math.random()*ARENA_W;y=-200;}
  else if(side===1){x=ARENA_W+200;y=Math.random()*ARENA_H;}
  else if(side===2){x=Math.random()*ARENA_W;y=ARENA_H+200;}
  else{x=-200;y=Math.random()*ARENA_H;}
  enemies.push({x,y,r:90,hp:40,img:bossImg,speed:1.5,isBoss:true});
  bossSpawned=true;
}

// Update
function update(){
  frames++;
  const now=performance.now();
  const timeElapsed=Math.floor((now-startTime)/1000);

  let nx=player.x,ny=player.y;
  if(keys['w'])ny-=player.speed;
  if(keys['s'])ny+=player.speed;
  if(keys['a'])nx-=player.speed;
  if(keys['d'])nx+=player.speed;
  player.x=Math.max(0,Math.min(ARENA_W,nx));
  player.y=Math.max(0,Math.min(ARENA_H,ny));

  bullets.forEach(b=>{b.x+=b.dx;b.y+=b.dy;});
  bullets=bullets.filter(b=>b.x>0&&b.x<ARENA_W&&b.y>0&&b.y<ARENA_H);

  // spawn normal enemies until boss trigger
  if(player.kills<BOSS_TRIGGER_KILLS && frames%Math.floor(spawnInterval)===0){
    spawnEnemy();spawnInterval*=SPAWN_ACCELERATION;
  }
  // spawn boss once
  if(!bossSpawned && player.kills>=BOSS_TRIGGER_KILLS){spawnBoss();}

  enemySpeed*=1.0005;

  enemies.forEach(e=>{
    const dx=player.x-e.x,dy=player.y-e.y;
    const dist=Math.hypot(dx,dy);
    e.x+=dx/dist*e.speed;
    e.y+=dy/dist*e.speed;
  });

  bullets.forEach((b,bi)=>{
    enemies.forEach((e,ei)=>{
      const dx=b.x-e.x,dy=b.y-e.y;
      if(Math.hypot(dx,dy)<e.r){
        e.hp--;bullets.splice(bi,1);
        if(e.hp<=0){
          enemies.splice(ei,1);
          player.kills++;
        }
      }
    });
  });

  enemies.forEach(e=>{
    if(Math.hypot(e.x-player.x,e.y-player.y)<e.r+player.r){
      player.alive=false;
      gameOver(timeElapsed);
    }
  });

  camX=player.x-w/2;camY=player.y-h/2;
  document.getElementById("hud").textContent=`Time: ${timeElapsed}s | Kills: ${player.kills}`;
}

// Draw
let t=0;
function draw(){
  const grd=ctx.createLinearGradient(0,0,w,h);
  grd.addColorStop(0,"#050005");
  grd.addColorStop(1,"#200030");
  ctx.fillStyle=grd;
  ctx.fillRect(0,0,w,h);

  ctx.save();ctx.translate(-camX,-camY);
  enemies.forEach(e=>{
    ctx.drawImage(e.img,e.x-e.r,e.y-e.r,e.r*2,e.r*2);
  });

  ctx.fillStyle="#ff0";
  bullets.forEach(b=>ctx.fillRect(b.x-2,b.y-2,4,4));

  t+=0.05;
  const pulse=1+Math.sin(t*4)*0.05;
  ctx.save();
  ctx.translate(player.x,player.y);
  ctx.scale(pulse,pulse);
  ctx.drawImage(playerImg,-player.r,-player.r,player.r*2,player.r*2);
  ctx.restore();
  ctx.restore();
}

function gameOver(timeElapsed){
  running=false;
  gameover.style.display="flex";
  stats.textContent=`You survived ${timeElapsed}s with ${player.kills} kills.`;
}

// Loop
function loop(){
  if(!running)return;
  update();draw();
  if(player.alive)requestAnimationFrame(loop);
}
</script>
</body>
</html>
