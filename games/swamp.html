<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Swamp</title>
<style>
html, body {
  margin: 0;
  height: 100%;
  background: #000;
  overflow: hidden;
}
canvas {
  display: block;
  width: 100vw;
  height: 100vh;
}
</style>
</head>
<body>

<canvas id="c"></canvas>

<img id="shrek" src="./media/images/shrek.png"
  style="
    position: fixed;
    width: 128px;
    left: 100px;
    top: 100px;
    cursor: pointer;
    z-index: 9999;
    user-select: none;
  ">

<audio id="hitSound" src="./media/audio/hitmarker.mp3" preload="auto"></audio>
<audio id="deathSound" src="./media/audio/oof.mp3" preload="auto"></audio>

<script>
/* ---------- AUDIO UNLOCK ---------- */
let audioUnlocked = false;
addEventListener('pointerdown', () => {
  if (audioUnlocked) return;
  audioUnlocked = true;
  document.getElementById('hitSound').play().catch(()=>{});
  document.getElementById('deathSound').play().catch(()=>{});
}, { once:true });
</script>

<script>
/* ---------- SHREK ---------- */
(() => {
  const shrek = document.getElementById('shrek');
  const hit = document.getElementById('hitSound');
  const death = document.getElementById('deathSound');

  let vx = 2.5, vy = 2.2;
  let clicks = 0;
  let alive = true;

  function move() {
    if (!alive) return;
    const r = shrek.getBoundingClientRect();

    if (r.left <= 0 || r.right >= innerWidth) vx *= -1;
    if (r.top <= 0 || r.bottom >= innerHeight) vy *= -1;

    shrek.style.left = (r.left + vx) + "px";
    shrek.style.top  = (r.top  + vy) + "px";

    requestAnimationFrame(move);
  }

  shrek.onclick = e => {
    e.stopPropagation();
    if (!alive) return;

    clicks++;
    hit.currentTime = 0;
    hit.play().catch(()=>{});

    if (clicks >= 8) die();
  };

  function die() {
    alive = false;
    death.play().catch(()=>{});

    const r = shrek.getBoundingClientRect();
    const cx = r.left + r.width/2;
    const cy = r.top + r.height/2;
    shrek.remove();

    for (let i=0;i<20;i++){
      const p = document.createElement('div');
      p.style.position='fixed';
      p.style.left=cx+'px';
      p.style.top=cy+'px';
      p.style.width='6px';
      p.style.height='6px';
      p.style.background='lime';
      p.style.borderRadius='50%';
      p.style.pointerEvents='none';
      document.body.appendChild(p);

      const a=Math.random()*Math.PI*2;
      const s=2+Math.random()*4;
      let life=30;

      (function step(){
        p.style.left=(p.offsetLeft+Math.cos(a)*s)+'px';
        p.style.top =(p.offsetTop +Math.sin(a)*s)+'px';
        p.style.opacity=life/30;
        if(--life>0) requestAnimationFrame(step);
        else p.remove();
      })();
    }
  }

  move();
})();
</script>

<script>
/* ---------- LAVA LAMP (RESTORED) ---------- */
(() => {
  const canvas = document.getElementById('c');
  const ctx = canvas.getContext('2d');
  let w,h;

  function resize(){
    w = canvas.width = innerWidth;
    h = canvas.height = innerHeight;
  }
  addEventListener('resize', resize);
  resize();

  function noise(x,y,t){
    return Math.sin(x*0.01+t)+Math.sin(y*0.01-t);
  }

  function frame(t){
    const img = ctx.createImageData(w,h);
    const d = img.data;
    for(let y=0;y<h;y++){
      for(let x=0;x<w;x++){
        const i=(y*w+x)*4;
        const n=noise(x,y,t*0.001);
        d[i]=20+n*40;
        d[i+1]=80+n*60;
        d[i+2]=40+n*30;
        d[i+3]=255;
      }
    }
    ctx.putImageData(img,0,0);
    requestAnimationFrame(frame);
  }
  requestAnimationFrame(frame);
})();
</script>

</body>
</html>
