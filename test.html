<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Psychedelic CRT Lava Noise (Fixed)</title>
<style>
  html, body {
    margin: 0;
    padding: 0;
    overflow: hidden;
    height: 100%;
    background: black;
  }
  canvas {
    width: 100%;
    height: 100%;
    display: block;
    filter: contrast(140%) saturate(160%) brightness(120%) blur(0.5px);
  }
</style>
</head>
<body>
<canvas id="lava"></canvas>
<script>
const c = document.getElementById('lava');
const ctx = c.getContext('2d');
let w, h;
function resize() {
  w = c.width = window.innerWidth;
  h = c.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

const blobs = Array.from({length: 10}, () => ({
  x: Math.random()*w,
  y: Math.random()*h,
  r: 180 + Math.random()*180,
  dx: (Math.random()-0.5)*1.5,
  dy: (Math.random()-0.5)*1.5,
  phase: Math.random()*Math.PI*2
}));

function drawNoise() {
  const id = ctx.createImageData(w, h);
  for (let i=0; i<id.data.length; i+=4) {
    const v = Math.random()*255;
    id.data[i] = v;
    id.data[i+1] = v;
    id.data[i+2] = v;
    id.data[i+3] = 10;
  }
  ctx.putImageData(id,0,0);
}

function drawCRT() {
  ctx.fillStyle="rgba(0,0,0,0.15)";
  for(let y=0;y<h;y+=3) ctx.fillRect(0,y,w,1);
}

function render(t) {
  ctx.fillStyle = "black";
  ctx.fillRect(0,0,w,h);

  const baseHue = (t/50)%360;

  // glowing background gradient
  const bg = ctx.createRadialGradient(w/2,h/2,0,w/2,h/2,Math.max(w,h)/1.2);
  bg.addColorStop(0,`hsl(${baseHue},100%,40%)`);
  bg.addColorStop(1,`hsl(${(baseHue+120)%360},100%,5%)`);
  ctx.globalCompositeOperation='source-over';
  ctx.fillStyle=bg;
  ctx.fillRect(0,0,w,h);

  // glowing blobs
  ctx.globalCompositeOperation='screen';
  blobs.forEach(b=>{
    b.x+=b.dx; b.y+=b.dy;
    if(b.x<0||b.x>w) b.dx*=-1;
    if(b.y<0||b.y>h) b.dy*=-1;
    b.phase+=0.02;
    const pulse=Math.sin(b.phase)*30;
    const hue=(baseHue+b.x/10)%360;

    const off=Math.sin(t/500+b.phase)*3;
    ['#f00','#0ff','#00f'].forEach((clr,i)=>{
      const ox=b.x+Math.sin(i*2)*off*3;
      const oy=b.y+Math.cos(i*2)*off*3;
      const grad=ctx.createRadialGradient(ox,oy,0,ox,oy,b.r+pulse);
      grad.addColorStop(0,`hsla(${hue+i*40},100%,65%,0.7)`);
      grad.addColorStop(1,`hsla(${hue+i*40},100%,10%,0)`);
      ctx.fillStyle=grad;
      ctx.beginPath();
      ctx.arc(ox,oy,b.r+pulse,0,Math.PI*2);
      ctx.fill();
    });
  });

  ctx.globalCompositeOperation='overlay';
  drawCRT();

  ctx.globalCompositeOperation='lighten';
  drawNoise();

  requestAnimationFrame(render);
}
render(0);
</script>
</body>
</html>
