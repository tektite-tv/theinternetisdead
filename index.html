<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Glitchcore 95</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Courier New', monospace; }

    /* Hide the OS cursor when glitch cursor is enabled */
    .use-glitch-cursor, .use-glitch-cursor * { cursor: none !important; }
    @media (prefers-reduced-motion: reduce) { .use-glitch-cursor, .use-glitch-cursor * { cursor: auto !important; } }

    html, body { height: 100%; background: #000; color: #00FFCC; overflow: hidden; transition: transform 1s ease-in-out; }
    .rotate { transform: rotate(360deg); }

    /* Desktop area above the taskbar */
    .desktop {
      position: fixed; inset: 0 0 40px 0; z-index: 0;
      background:
        repeating-linear-gradient(135deg, rgba(0,255,204,0.10) 0px, rgba(0,255,204,0.10) 2px, rgba(0,0,0,0.0) 2px, rgba(0,0,0,0.0) 6px),
        radial-gradient(1200px 1200px at 0% 0%, rgba(0,255,204,0.12) 0%, rgba(0,255,204,0.05) 30%, rgba(0,0,0,0.0) 60%),
        linear-gradient(135deg, #000000 0%, #141414 50%, #000000 100%);
      background-size: auto, 100% 100%, 100% 100%;
      --scan-speed: 22s;
      animation: scanScroll var(--scan-speed) linear infinite;
    }
    @keyframes scanScroll {
      from { background-position: 0px 0px, 0 0, 0 0; }
      to   { background-position: 800px 800px, 0 0, 0 0; }
    }
    @media (prefers-reduced-motion: reduce) { .desktop { animation: none; } }

    .taskbar {
      position: fixed; bottom: 0; left: 0; width: 100%; height: 40px;
      background: linear-gradient(to top, #444, #222);
      border-top: 2px solid #00FFCC;
      display: flex; align-items: center; justify-content: space-between;
      padding: 0 8px; z-index: 1000; text-shadow: 1px 1px #000;
    }
    .menu-button {
      background: linear-gradient(to bottom, #333, #111);
      border: 2px outset #00FFCC; color: #00FFCC; padding: 4px 12px; text-shadow: 1px 1px #000;
    }
    .menu-button:hover { background: #000; }

    .menu-popup {
      position: absolute; bottom: 42px; left: 8px; width: 170px;
      background: #111; border: 2px outset #00FFCC; box-shadow: 0 0 5px #00ffcc99;
      display: none; flex-direction: column; z-index: 1001;
    }
    .menu-popup a {
      color: #00FFCC; padding: 10px; text-decoration: none; border-bottom: 1px solid #00FFCC;
    }
    .menu-popup a:hover { background: #222; }

    .clock { background: #111; padding: 4px 10px; border: 2px inset #00FFCC; color: #00FFCC; text-shadow: 1px 1px #000; }

    /* === Glitch Cursor (diagonal) === */
    .glitch-cursor {
      position: fixed; top: 0; left: 0; width: auto; height: auto; font-size: 18px; line-height: 1; color: #00FFCC;
      pointer-events: none; z-index: 10000;
      text-shadow: 0 0 2px rgba(0,255,204,0.9), 1px 0 rgba(255,0,128,0.6), -1px 0 rgba(0,128,255,0.6);
      mix-blend-mode: screen; will-change: transform, opacity, filter;
      transform: translate3d(-50%, -50%, 0) rotate(45deg);
      filter: drop-shadow(0 0 2px rgba(0,255,204,0.75)); user-select: none; display: none;
    }
    .glitch-cursor .ring {
      position: absolute; top: 50%; left: 50%;
      transform: translate(-50%, -50%) rotate(45deg);
      width: 18px; height: 18px; border: 2px solid rgba(0,255,204,0.6); border-radius: 4px;
      box-shadow: 0 0 6px rgba(0,255,204,0.5); animation: ringPulse 1.2s ease-in-out infinite;
    }
    @keyframes ringPulse {
      0%,100% { transform: translate(-50%, -50%) rotate(45deg) scale(1); opacity: 0.9; }
      50%     { transform: translate(-50%, -50%) rotate(45deg) scale(1.2); opacity: 0.6; }
    }
    .cursor-trail {
      position: fixed; font-size: 14px; color: #00FFCC; pointer-events: none; mix-blend-mode: screen; opacity: 0.85;
      text-shadow: 0 0 2px rgba(0,255,204,0.9), 1px 0 rgba(255,0,128,0.5), -1px 0 rgba(0,128,255,0.5);
      will-change: transform, opacity; z-index: 9999; user-select: none; transform: rotate(45deg);
    }
    .cursor-trail.fade { transition: transform 300ms ease, opacity 350ms ease; opacity: 0; }
    @media (prefers-reduced-motion: reduce) { .glitch-cursor, .cursor-trail { display: none !important; } }

    /* === Drag-to-Create Boxes === */
    .draw-ghost {
      position: absolute;
      border: 2px dashed rgba(0,255,204,0.7);
      background: rgba(0,255,204,0.08);
      box-shadow: inset 0 0 8px rgba(0,255,204,0.25);
      pointer-events: none;
    }
    .desk-box {
      position: absolute;
      background: rgba(0, 10, 10, 0.65);
      border: 2px solid #00FFCC;
      box-shadow: 0 0 10px #00ffcc66, inset 0 0 12px #00ffcc22;
      min-width: 16px; min-height: 16px;
      /* keep it under the taskbar and above the desktop */
      z-index: 10;
    }
    .desk-box .titlebar {
      height: 18px;
      background: linear-gradient(to bottom, #0c3, #033);
      color: #001a16;
      font-weight: bold;
      font-size: 12px;
      letter-spacing: 0.5px;
      padding: 0 6px;
      display: flex; align-items: center; justify-content: space-between;
      cursor: move;
      user-select: none;
      text-shadow: 0 1px #00ffcc;
    }
    .desk-box .content {
      padding: 6px; color: #00FFCC; font-size: 12px;
    }
    .desk-box .close {
      background: #011; border: 1px solid #00FFCC; color: #00FFCC; font-size: 10px; padding: 0 4px;
      cursor: pointer;
    }
    .desk-box:focus-within,
    .desk-box.active { box-shadow: 0 0 14px #00ffccaa, inset 0 0 12px #00ffcc33; }
  </style>
</head>
<body>
  <!-- Desktop drawing surface -->
  <div class="desktop" id="desktop" aria-hidden="false"></div>

  <!-- Taskbar -->
  <div class="taskbar">
    <div class="menu-area">
      <div class="menu-button" onclick="toggleMenu()">Menu</div>
      <div class="menu-popup" id="menuPopup">
        <a href="/images" target="_blank">üñºÔ∏è Images</a>
        <a href="/sounds" target="_blank">üîä Sounds</a>
        <a href="#" id="toggleCursor">üñ±Ô∏è Toggle Glitch Cursor</a>
      </div>
    </div>
    <div class="clock" id="clock" onclick="doABarrelRoll()">--:-- üåÄ</div>
  </div>

  <!-- Glitch cursor -->
  <div id="glitchCursor" class="glitch-cursor" aria-hidden="true">
    <div class="ring"></div>
    <span id="glitchGlyph">‚üü</span>
  </div>

  <script>
    /* ===== Clock ===== */
    function updateClock() {
      const clock = document.getElementById('clock');
      const now = new Date();
      let h = now.getHours();
      const m = now.getMinutes().toString().padStart(2, '0');
      const ampm = h >= 12 ? 'PM' : 'AM';
      h = h % 12 || 12;
      clock.innerHTML = `${h}:${m} ${ampm} üåÄ`;
    }
    setInterval(updateClock, 1000); updateClock();

    function toggleMenu() {
      const menu = document.getElementById('menuPopup');
      menu.style.display = menu.style.display === 'flex' ? 'none' : 'flex';
    }
    document.addEventListener('click', (e) => {
      const menu = document.getElementById('menuPopup');
      const button = document.querySelector('.menu-button');
      if (!menu.contains(e.target) && !button.contains(e.target)) menu.style.display = 'none';
    });
    function doABarrelRoll() {
      document.body.classList.add('rotate');
      setTimeout(() => document.body.classList.remove('rotate'), 1000);
    }

    /* ===== Glitch Cursor (diagonal) ===== */
    const prefersReduced = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
    const htmlTag = document.documentElement;
    const cursorEl = document.getElementById('glitchCursor');
    const glyphEl = document.getElementById('glitchGlyph');
    const toggleCursorLink = document.getElementById('toggleCursor');
    let cursorEnabled = !prefersReduced;
    let lastX = innerWidth / 2, lastY = innerHeight / 2;
    let targetX = lastX, targetY = lastY;

    const base = "ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789";
    const blocks = "‚ñë‚ñí‚ñì‚ñà‚ñû‚ñö‚ñõ‚ñú‚ñü‚ñô‚ñê‚ñå‚ññ‚ñó‚ñò‚ñù‚ñû‚ñö";
    const misc = "‚ú∂‚úπ‚ú¶‚úß‚ú™‚ú±‚ú≤‚ú≥‚ú¥‚úµ‚òº‚òÑ‚òØ‚ò¢‚ò£‚ò∞‚ò±‚ò≤‚ò≥‚ò¥‚òµ‚ò∂‚ò∑‚üü‚óà‚óá‚óÜ‚óá‚óç‚óå‚óâ‚óé‚óè‚óò‚óô‚óã‚óî‚óï‚óñ‚óó‚ó©‚ó™‚ó´‚ó¨‚ó≠‚óÆ‚óØ";
    const zalgoUp = ["\u030d","\u030e","\u0304","\u0305","\u033f","\u0311","\u0306","\u0310","\u0352","\u0357","\u0351","\u0307","\u0308","\u030a","\u0342","\u0343","\u0344","\u034a","\u034b","\u034c","\u0303","\u0302","\u030c","\u0350","\u0300","\u0301","\u030b","\u030f","\u0312","\u0313","\u0314","\u033d","\u0309","\u0363","\u0364","\u0365","\u0366","\u0367","\u0368","\u0369","\u036a","\u036b","\u036c","\u036d","\u036e","\u036f","\u033e","\u035b","\u0346","\u031a"];
    const zalgoMid = ["\u0315","\u031b","\u0340","\u0341","\u0358","\u0321","\u0322","\u0327","\u0328","\u0334","\u0335","\u0336","\u034f","\u035c","\u035d","\u035e","\u035f","\u0360","\u0362","\u0338","\u0337","\u0361","\u0489"];
    const zalgoDown = ["\u0316","\u0317","\u0318","\u0319","\u031c","\u031d","\u031e","\u031f","\u0320","\u0324","\u0325","\u0326","\u0329","\u032a","\u032b","\u032c","\u032d","\u032e","\u032f","\u0330","\u0331","\u0332","\u0333","\u0339","\u033a","\u033b","\u033c","\u0345","\u0347","\u0348","\u0349","\u034d","\u034e","\u0353","\u0354","\u0355","\u0356","\u0359","\u035a"];

    const rand = arr => arr[Math.floor(Math.random()*arr.length)];
    const randInt = (min,max) => Math.floor(Math.random()*(max-min+1))+min;

    function makeZalgoGlyph() {
      const baseChar = Math.random() < 0.6 ? rand(base) : (Math.random() < 0.5 ? rand(blocks) : rand(misc));
      const up = Array.from({length: randInt(1,3)}, () => rand(zalgoUp)).join("");
      const mid = Array.from({length: randInt(0,2)}, () => rand(zalgoMid)).join("");
      const down = Array.from({length: randInt(1,3)}, () => rand(zalgoDown)).join("");
      return baseChar + up + mid + down;
    }
    function setGlyph(){ glyphEl.textContent = makeZalgoGlyph(); }

    function spawnTrail(x, y) {
      if (!cursorEnabled) return;
      const t = document.createElement('div');
      t.className = 'cursor-trail';
      t.textContent = makeZalgoGlyph();
      t.style.transform = `translate3d(${x}px, ${y}px, 0) rotate(45deg)`;
      document.body.appendChild(t);
      requestAnimationFrame(() => {
        t.classList.add('fade');
        const dx = randInt(-12, 12), dy = randInt(-12, 12);
        t.style.transform = `translate3d(${x+dx}px, ${y+dy}px, 0) rotate(45deg)`;
      });
      setTimeout(() => t.remove(), 420);
    }

    function onMove(e) {
      if (!cursorEnabled) return;
      targetX = e.clientX; targetY = e.clientY;
      if (Math.random() < 0.6) spawnTrail(targetX, targetY);
    }

    function animate() {
      if (!cursorEnabled) { requestAnimationFrame(animate); return; }
      const lerp = 0.18;
      lastX += (targetX - lastX) * lerp;
      lastY += (targetY - lastY) * lerp;
      cursorEl.style.transform = `translate3d(${lastX}px, ${lastY}px, 0) rotate(45deg)`;
      requestAnimationFrame(animate);
    }

    function enableCursor() {
      cursorEnabled = true;
      htmlTag.classList.add('use-glitch-cursor');
      cursorEl.style.display = 'block';
      toggleCursorLink.textContent = 'üñ±Ô∏è Toggle Glitch Cursor (ON)';
    }
    function disableCursor() {
      cursorEnabled = false;
      htmlTag.classList.remove('use-glitch-cursor');
      cursorEl.style.display = 'none';
      toggleCursorLink.textContent = 'üñ±Ô∏è Toggle Glitch Cursor (OFF)';
    }

    if (prefersReduced) { disableCursor(); }
    else {
      enableCursor(); setGlyph();
      window.addEventListener('mousemove', onMove, { passive: true });
      animate();
      setInterval(() => { if (cursorEnabled) setGlyph(); }, 90);
    }
    toggleCursorLink.addEventListener('click', (e) => {
      e.preventDefault();
      if (cursorEnabled) disableCursor(); else enableCursor();
    });
    window.addEventListener('resize', () => {
      targetX = Math.min(innerWidth, Math.max(0, targetX));
      targetY = Math.min(innerHeight, Math.max(0, targetY));
    }, { passive: true });

    /* ===== Drag to Create Boxes ===== */
    const desktop = document.getElementById('desktop');
    let drawing = false, startX = 0, startY = 0, ghost = null;

    function toDesktopCoords(ev) {
      const r = desktop.getBoundingClientRect();
      return { x: ev.clientX - r.left, y: ev.clientY - r.top, rect: r };
    }

    desktop.addEventListener('mousedown', (ev) => {
      // Ignore clicks that start on an existing box titlebar, those are for dragging boxes
      if ((ev.target.closest('.desk-box'))) return;

      drawing = true;
      const { x, y } = toDesktopCoords(ev);
      startX = x; startY = y;

      ghost = document.createElement('div');
      ghost.className = 'draw-ghost';
      ghost.style.left = `${x}px`;
      ghost.style.top = `${y}px`;
      ghost.style.width = '0px';
      ghost.style.height = '0px';
      desktop.appendChild(ghost);
      ev.preventDefault();
    });

    window.addEventListener('mousemove', (ev) => {
      if (!drawing || !ghost) return;
      const { x, y } = toDesktopCoords(ev);

      const left = Math.min(x, startX);
      const top  = Math.min(y, startY);
      const w = Math.abs(x - startX);
      const h = Math.abs(y - startY);

      ghost.style.left = `${left}px`;
      ghost.style.top  = `${top}px`;
      ghost.style.width = `${w}px`;
      ghost.style.height = `${h}px`;
    }, { passive: true });

    window.addEventListener('mouseup', (ev) => {
      if (!drawing) return;
      drawing = false;

      const rect = ghost.getBoundingClientRect();
      const drect = desktop.getBoundingClientRect();
      const w = rect.width, h = rect.height;
      const left = parseFloat(ghost.style.left);
      const top  = parseFloat(ghost.style.top);

      ghost.remove();
      ghost = null;

      // Minimum size to avoid accidental dots
      if (w < 8 || h < 8) return;

      spawnDeskBox(left, top, w, h);
    });

    function spawnDeskBox(x, y, w, h) {
      const box = document.createElement('div');
      box.className = 'desk-box';
      box.style.left = `${x}px`;
      box.style.top  = `${y}px`;
      box.style.width = `${w}px`;
      box.style.height= `${h}px`;

      const title = document.createElement('div');
      title.className = 'titlebar';
      title.innerHTML = `<span>BOX ${Math.random().toString(36).slice(2,6).toUpperCase()}</span>`;
      const close = document.createElement('button');
      close.className = 'close';
      close.textContent = 'X';
      close.addEventListener('click', (e) => { e.stopPropagation(); box.remove(); });

      title.appendChild(close);

      const content = document.createElement('div');
      content.className = 'content';
      content.textContent = 'Drag my title to move me. Create more by click-dragging the desktop.';

      box.appendChild(title);
      box.appendChild(content);
      desktop.appendChild(box);

      // Bring to front on click
      box.addEventListener('mousedown', () => {
        document.querySelectorAll('.desk-box').forEach(b => b.classList.remove('active'));
        box.classList.add('active');
        box.style.zIndex = (parseInt(box.style.zIndex || '10', 10) + 1).toString();
      });

      makeDraggable(box, title);
    }

    function makeDraggable(box, handle) {
      let drag = false, offX = 0, offY = 0;

      handle.addEventListener('mousedown', (ev) => {
        drag = true;
        const r = box.getBoundingClientRect();
        const d = desktop.getBoundingClientRect();
        offX = ev.clientX - r.left;
        offY = ev.clientY - r.top;
        ev.preventDefault();
      });

      window.addEventListener('mousemove', (ev) => {
        if (!drag) return;
        const d = desktop.getBoundingClientRect();
        let nx = ev.clientX - d.left - offX;
        let ny = ev.clientY - d.top  - offY;

        // keep within desktop bounds
        nx = Math.max(0, Math.min(nx, d.width  - box.offsetWidth));
        ny = Math.max(0, Math.min(ny, d.height - box.offsetHeight));

        box.style.left = `${nx}px`;
        box.style.top  = `${ny}px`;
      }, { passive: true });

      window.addEventListener('mouseup', () => { drag = false; });
    }
  </script>
</body>
</html>
