<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>theinternetisdead.org - Home</title>
  <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
  <link rel="icon" type="image/png" href="/images/face.png">
  <style>
/* GLOBAL RESET AND BASE --------------------------------- */
* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
  font-family: "Courier New", monospace;
}

html, body {
  height: 100%;
  background-color: #000;
  color: #ddd;
  overflow-y: auto;
}

a {
  color: inherit;
  text-decoration: none;
}

/* HEADER / TASKBAR -------------------------------------- */
header {
  display: flex;
  flex-wrap: wrap;
  align-items: center;
  justify-content: space-between;
  background: #1a0033;
  color: #fff;
  padding: 16px 24px;
  border-bottom: 3px solid #cc181e;
  position: sticky;
  top: 0;
  z-index: 10;
  gap: 12px;
}

.left-section, .right-section {
  display: flex;
  align-items: center;
  gap: 16px;
  flex-shrink: 0;
}

.menu {
  cursor: pointer;
  font-size: 26px;
  font-weight: bold;
  background: none;
  border: none;
  color: #fff;
}

.logo {
  height: 36px;
  width: auto;
}

/* SEARCH BAR -------------------------------------------- */
.search-bar {
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 240px;
  max-width: 600px;
  margin: 0 auto;
}

.search-bar input {
  flex: 1;
  padding: 8px 12px;
  border: 1px solid #444;
  border-right: none;
  background: #000;
  color: #fff;
  font-size: 14px;
}

.search-bar button {
  padding: 8px 14px;
  border: 1px solid #444;
  background: #222;
  color: #fff;
  cursor: pointer;
  transition: background 0.2s;
}

.search-bar button:hover {
  background: #333;
}

/* MOBILE HEADER ------------------------------------------ */
@media (max-width: 768px) {
  header {
    flex-direction: column;
    align-items: stretch;
    padding: 12px;
  }

  .left-section {
    width: 100%;
    justify-content: space-between;
  }

  .search-bar {
    flex-direction: column;
    align-items: stretch;
    width: 100%;
    margin-top: 8px;
  }

  .search-bar input {
    width: 100%;
    font-size: 1rem;
    padding: 0.75rem;
    border-radius: 6px;
    margin-bottom: 6px;
    border: 1px solid #0f0;
  }

  .search-bar button {
    width: 100%;
    padding: 0.75rem;
    font-size: 1rem;
    border-radius: 6px;
    border: 1px solid #0f0;
    background: #0a0;
    color: #000;
    font-weight: bold;
  }

  #search-popup {
    width: 95%;
    left: 2.5%;
    right: 2.5%;
    max-height: 60vh;
    overflow-y: auto;
  }
}

/* MAIN LAYOUT -------------------------------------------- */
main {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(420px, 1fr));
  gap: 32px;
  padding: 32px;
  justify-content: center;
  max-width: 1200px;
  margin: 0 auto;
}

@media (max-width: 1100px) {
  main {
    gap: 20px;
    padding: 20px;
  }
}

.column {
  background: #0a0a0a;
  padding: 20px;
  border: 1px solid #222;
  border-radius: 6px;
  box-shadow: 0 0 10px rgba(255, 255, 255, 0.05);
  z-index: 1;
  overflow: hidden;
}

.post img {
  display: block;
  max-width: 100%;
  border-radius: 4px;
  margin: 12px 0;
}

/* RESPONSIVE VIDEOS -------------------------------------- */
.video iframe {
  width: 100%;
  aspect-ratio: 16/9;
  border: none;
  border-radius: 6px;
  margin: 12px 0;
}

/* LIGHTBOX ----------------------------------------------- */
#img-lightbox {
  position: fixed;
  inset: 0;
  display: none;
  align-items: center;
  justify-content: center;
  background: rgba(0, 0, 0, 0.9);
  z-index: 100000;
}

#img-lightbox.visible {
  display: flex;
}

#img-lightbox .inner {
  position: relative;
  max-width: min(92vw, 1400px);
  max-height: 90vh;
  display: flex;
  flex-direction: column;
  gap: 12px;
  padding: 8px;
}

#img-lightbox img {
  max-width: 100%;
  max-height: 80vh;
  border-radius: 8px;
  border: 1px solid #0f0;
  box-shadow: 0 0 24px #0f06;
}

#img-lightbox .toolbar {
  display: flex;
  align-items: center;
  justify-content: space-between;
  color: #0f0;
}

#img-lightbox .download-btn,
#img-lightbox .close-x {
  background: rgba(0, 0, 0, 0.85);
  color: #0f0;
  border: 2px solid #0f0;
  border-radius: 6px;
  padding: 8px 12px;
  cursor: pointer;
  text-decoration: none;
  transition: all 0.2s;
}

#img-lightbox .download-btn:hover,
#img-lightbox .close-x:hover {
  background: #0f0;
  color: #000;
  box-shadow: 0 0 18px rgba(0, 255, 0, 0.6);
}

#img-lightbox .filename {
  color: #0f0;
  text-align: center;
  font-family: monospace;
  font-size: 0.9rem;
  opacity: 0.9;
}

/* FOOTER ------------------------------------------------- */
.footer {
  text-align: center;
  margin-top: 40px;
  color: #ccc;
}
</style>
</head>

<body>
  <header>
    <div class="left-section">
      <button class="menu">&#9776;</button>
      <a href="index.html" class="flex items-center gap-3">
        <img class="logo" src="/images/uploads/deadlogo-green.png" alt="TheInternetIsDead Logo" />
        <span style="color:#00ff99;font-size:14px;">The webmaster is not harvesting your soul for profit.</span>
      </a>
    </div>

    <div class="search-bar search-wrapper">
      <input type="text" class="search-input" placeholder="Search..." />
      <button class="search-btn" aria-label="Search">üîç</button>
      <div id="search-popup"></div>
    </div>

    <div class="right-section">
      <a href="mailto:nobody@theinternetisdead.org" class="submit-btn">Submit</a>
    </div>
  </header>

  <main>
    <section class="column" id="posts">
      <h1 style="color:#00ff99;">üåÄ The Daily Spiral</h1>
      <h2>Latest Blog Posts</h2>
      <p>Loading posts...</p>
    </section>
    <section class="column" id="youtube">
      <h1 style="color:#66ccff;">My Latest Broadcast</h1>
      <h2>Honestly Thomas (Tektite) on YouTube</h2>
      <p>Loading videos...</p>
    </section>
  </main>

  <div class="footer">Copyright 2025 &bull; theinternetisdead.org</div>

  <div id="img-lightbox" aria-modal="true" role="dialog">
    <div class="inner">
      <button class="close-x" aria-label="Close">‚úï</button>
      <img src="" alt="">
      <div class="toolbar">
        <span class="filename"></span>
        <a class="download-btn" href="" download>Download</a>
      </div>
    </div>
  </div>

<script>
document.addEventListener("DOMContentLoaded", async () => {
  const postsContainer=document.getElementById("posts");
  const youtubeContainer=document.getElementById("youtube");
  const searchInput=document.querySelector(".search-input");
  const searchBtn=document.querySelector(".search-btn");
  const popup=document.getElementById("search-popup");

  let allPosts=[],allVideos=[],INDEX=[];

  function openPopup(){popup.style.display="block";}
  function closePopup(){popup.style.display="none";}

  async function loadPosts(){
    try{
      const res=await fetch("/_posts/index.json");
      if(!res.ok)throw new Error(`HTTP ${res.status}`);
      allPosts=await res.json();
      allPosts.sort((a,b)=>new Date(b.date)-new Date(a.date));
      renderPosts();
    }catch(err){postsContainer.innerHTML=`<p style='color:red;'>Error loading posts: ${err.message}</p>`;}
  }

  async function renderPosts(){
    postsContainer.innerHTML="<h1 style='color:#00ff99;'>üåÄ The Daily Spiral</h1><h2>Latest Blog Posts</h2>";
    const displayed=allPosts.slice(0,3);
    for(const p of displayed){
      const wrapper=document.createElement("div");
      wrapper.className="post";
      wrapper.innerHTML=`<h3>${p.title}</h3><small>${new Date(p.date).toLocaleString()}</small>${p.image?`<img src='${p.image}' alt='${p.title}' loading='lazy'>`:""}<div class='content'><em>Loading...</em></div>`;
      postsContainer.appendChild(wrapper);
      try{
        let text=await (await fetch(p.file)).text();
        if(text.startsWith('---')){const end=text.indexOf('---',3);if(end!==-1)text=text.slice(end+3);}
        wrapper.querySelector(".content").innerHTML=marked.parse(text.trim());
      }catch{wrapper.querySelector(".content").innerHTML="<em>Unable to load post.</em>";}
    }
    const lightbox=document.getElementById("img-lightbox");
    const lightImg=lightbox.querySelector("img");
    const filenameEl=lightbox.querySelector(".filename");
    const dlBtn=lightbox.querySelector(".download-btn");
    const closeBtn=lightbox.querySelector(".close-x");

    postsContainer.querySelectorAll("img").forEach(img=>{
      img.addEventListener("click",()=>{
        lightImg.src=img.src;
        dlBtn.href=img.src;
        filenameEl.textContent=img.src.split("/").pop();
        lightbox.classList.add("visible");
      });
    });
    closeBtn.onclick=()=>lightbox.classList.remove("visible");
    lightbox.onclick=e=>{if(e.target===lightbox)lightbox.classList.remove("visible");};
    document.addEventListener("keydown",e=>{if(e.key==="Escape")lightbox.classList.remove("visible");});
  }

  async function loadVideos(){
    try{
      const feed="https://www.youtube.com/feeds/videos.xml?channel_id=UCn3WLZT7k8nO24XimlJVJVQ";
      const rssRes=await fetch(`https://api.rss2json.com/v1/api.json?rss_url=${encodeURIComponent(feed)}`);
      const rssData=await rssRes.json();
      allVideos=rssData.items||[];
      renderVideos();
    }catch(err){youtubeContainer.innerHTML=`<p style='color:red;'>Error loading videos: ${err.message}</p>`;}
  }
  function renderVideos(){
    const vids=allVideos.slice(0,3);
    youtubeContainer.innerHTML=`<h1 style='color:#66ccff;'>My Latest Broadcast</h1><h2>Honestly Thomas (Tektite)</h2>`+
      vids.map(v=>`<div class='video'><iframe src='https://www.youtube.com/embed/${v.guid?.split(":").pop()||""}' allowfullscreen></iframe><a href='${v.link}' target='_blank'>${v.title}</a></div>`).join("");
  }

  await loadPosts();
  await loadVideos();
});
</script>
</body>
</html>
