<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Square Spiral Controls + Tunnel Mode</title>
<style>
    body {
        margin: 0;
        background: black;
        color: white;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    #controls {
        width: 100%;
        background: rgba(20, 20, 20, 0.9);
        padding: 15px;
        display: flex;
        justify-content: space-around;
        align-items: center;
        position: fixed;
        bottom: 0;
        left: 0;
        box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
        backdrop-filter: blur(6px);
    }

    .slider-block {
        width: 35%;
        text-align: center;
        font-family: sans-serif;
    }

    #tunnelButton {
        padding: 10px 20px;
        font-size: 16px;
        cursor: pointer;
        border: none;
        border-radius: 6px;
        background: #ff0099;
        color: white;
    }

    input[type="range"] {
        width: 100%;
    }

    canvas {
        flex: 1;
    }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="controls">
    <div class="slider-block">
        <label>Squares</label><br>
        <input type="range" id="squareSlider" min="1" max="60" value="30">
    </div>

    <button id="tunnelButton">Tunnel Mode: OFF</button>

    <div class="slider-block">
        <label>Size</label><br>
        <input type="range" id="sizeSlider" min="0.1" max="1.0" step="0.01" value="0.42">
    </div>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

const squareSlider = document.getElementById("squareSlider");
const sizeSlider = document.getElementById("sizeSlider");
const tunnelButton = document.getElementById("tunnelButton");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight - 80;
}
resize();
window.onresize = resize;

let spin = true;
let spinAngle = 0;
let tunnelMode = false;

// Colors
const colors = ["red", "green", "blue"];

function drawLayer(count, sizeScale, angleOffset = 0) {
    const size = Math.min(canvas.width, canvas.height) * sizeScale;

    for (let i = 0; i < count; i++) {
        const rot = (i * Math.PI * 2) / 60 + angleOffset;
        const color = colors[i % 3];

        ctx.save();
        ctx.translate(canvas.width / 2, canvas.height / 2);
        ctx.rotate(rot);
        ctx.strokeStyle = color;
        ctx.lineWidth = 2;
        ctx.beginPath();
        ctx.rect(-size/2, -size/2, size, size);
        ctx.stroke();
        ctx.restore();
    }
}

function drawScene() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const count = parseInt(squareSlider.value);
    const sizeScale = parseFloat(sizeSlider.value);

    if (!tunnelMode) {
        drawLayer(count, sizeScale, spinAngle);
        return;
    }

    // Tunnel recursion
    let layers = 12;
    let scale = sizeScale;
    let angle = spinAngle;

    for (let i = 0; i < layers; i++) {
        drawLayer(count, scale, angle);
        scale *= 0.80;       // shrink tunnel layers
        angle += 0.10;       // increase twist deeper inside
    }
}

function animate() {
    if (spin) spinAngle += 0.002;
    drawScene();
    requestAnimationFrame(animate);
}
animate();

// Interaction logic
function stopSpin() { spin = false; }
function startSpin() { spin = true; }

[squareSlider, sizeSlider].forEach(sl => {
    sl.addEventListener("input", stopSpin);
    sl.addEventListener("mousedown", stopSpin);
    sl.addEventListener("mouseup", startSpin);
    sl.addEventListener("touchstart", stopSpin);
    sl.addEventListener("touchend", startSpin);
});

tunnelButton.addEventListener("click", () => {
    tunnelMode = !tunnelMode;
    tunnelButton.textContent = "Tunnel Mode: " + (tunnelMode ? "ON" : "OFF");
});
</script>

</body>
</html>
