<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Square Spiral Controls</title>
<style>
    body {
        margin: 0;
        background: black;
        color: white;
        overflow: hidden;
        display: flex;
        flex-direction: column;
    }

    #controls {
        width: 100%;
        background: rgba(20, 20, 20, 0.9);
        padding: 15px;
        display: flex;
        flex-direction: row;
        justify-content: space-around;
        align-items: center;
        position: fixed;
        bottom: 0;
        left: 0;
        box-shadow: 0 -4px 20px rgba(0,0,0,0.5);
        backdrop-filter: blur(6px);
        font-family: sans-serif;
        gap: 5px;
    }

    .slider-block {
        width: 17%;
        text-align: center;
    }

    input[type="range"] {
        width: 100%;
    }

    canvas {
        flex: 1;
    }

    button {
        background: #333;
        color: white;
        border: 1px solid #777;
        padding: 10px 18px;
        cursor: pointer;
        border-radius: 6px;
    }

    button:hover {
        background: #555;
    }

    select {
        background: #222;
        color: white;
        padding: 5px;
        border-radius: 6px;
        border: 1px solid #777;
    }
</style>
</head>
<body>

<canvas id="c"></canvas>

<div id="controls">
    <div class="slider-block">
        <label>Squares</label><br>
        <input type="range" id="squareSlider" min="1" max="100" value="30">
    </div>

    <div class="slider-block">
        <label>Size</label><br>
        <input type="range" id="sizeSlider" min="0.1" max="1.0" step="0.01" value="0.42">
    </div>

    <div class="slider-block">
        <label>Spin Speed</label><br>
        <input type="range" id="speedSlider" min="0" max="0.02" step="0.0005" value="0.002">
    </div>

    <div class="slider-block">
        <label>Line Width</label><br>
        <input type="range" id="widthSlider" min="1" max="20" value="4">
    </div>

    <div class="slider-block">
        <label>Colors</label><br>
        <select id="colorMode">
            <option value="rgb">RGB Cycle</option>
            <option value="single">Single Color</option>
            <option value="hue">Hue Rotation</option>
        </select>
    </div>

    <button id="pulseBtn">Pulse Squares</button>
    <button id="vertexBtn">Vertex Rays</button>
    <button id="fullscreenBtn">Fullscreen</button>
</div>

<script>
const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

const squareSlider = document.getElementById("squareSlider");
const sizeSlider = document.getElementById("sizeSlider");
const speedSlider = document.getElementById("speedSlider");
const widthSlider = document.getElementById("widthSlider");
const colorMode = document.getElementById("colorMode");
const fullscreenBtn = document.getElementById("fullscreenBtn");
const pulseBtn = document.getElementById("pulseBtn");
const vertexBtn = document.getElementById("vertexBtn");

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight - 80;
}
resize();
window.onresize = resize;

let spin = true;
let spinAngle = 0;
let hueShift = 0;

// animation modes
let pulsing = false;
let pulseDirection = 1;
let pulseMin = 1;
let pulseMax = 100;

let vertexRays = false;

const colors = ["red", "green", "blue"];

function getColor(i) {
    const mode = colorMode.value;

    if (mode === "rgb") return colors[i % 3];
    if (mode === "single") return "white";
    if (mode === "hue") return `hsl(${(i * 10 + hueShift) % 360}, 100%, 50%)`;
}

function drawVertexRays(squareSize, rot, i) {
    const half = squareSize / 2;

    const vertices = [
        {x: -half, y: -half},
        {x: half, y: -half},
        {x: half, y: half},
        {x: -half, y: half}
    ];

    for (let v = 0; v < 4; v++) {
        ctx.save();
        ctx.rotate(rot);

        const vert = vertices[v];

        ctx.beginPath();
        ctx.moveTo(0, 0);
        ctx.lineTo(vert.x, vert.y);

        ctx.strokeStyle = `hsl(${(hueShift + i*6 + v*40) % 360}, 100%, 50%)`;
        ctx.lineWidth = 2;
        ctx.stroke();

        ctx.restore();
    }
}

function drawSquares(count, sizeScale, angleOffset = 0) {
    ctx.clearRect(0, 0, canvas.width, canvas.height);

    const size = Math.min(canvas.width, canvas.height) * sizeScale;

    for (let i = 0; i < count; i++) {
        const rot = (i * Math.PI * 2) / 60 + angleOffset;

        ctx.save();
        ctx.translate(canvas.width / 2, canvas.height / 2);

        if (vertexRays) drawVertexRays(size, rot, i);

        ctx.rotate(rot);
        ctx.strokeStyle = getColor(i);
        ctx.lineWidth = parseFloat(widthSlider.value);
        ctx.beginPath();
        ctx.rect(-size/2, -size/2, size, size);
        ctx.stroke();

        ctx.restore();
    }
}

function animate() {
    if (spin) {
        spinAngle += parseFloat(speedSlider.value);
        hueShift += 0.8;
    }

    if (pulsing) {
        let current = parseInt(squareSlider.value);
        current += pulseDirection;

        if (current >= pulseMax || current <= pulseMin) {
            pulseDirection *= -1;
        }

        squareSlider.value = current;
    }

    drawSquares(
        parseInt(squareSlider.value),
        parseFloat(sizeSlider.value),
        spinAngle
    );

    requestAnimationFrame(animate);
}
animate();

function stopSpin() { spin = false; }
function startSpin() { spin = true; }

[squareSlider, sizeSlider, speedSlider, widthSlider].forEach(sl => {
    sl.addEventListener("input", stopSpin);
    sl.addEventListener("mousedown", stopSpin);
    sl.addEventListener("mouseup", startSpin);
    sl.addEventListener("touchstart", stopSpin);
    sl.addEventListener("touchend", startSpin);
});

fullscreenBtn.onclick = () => {
    if (!document.fullscreenElement) {
        document.body.requestFullscreen();
    } else {
        document.exitFullscreen();
    }
};

pulseBtn.onclick = () => {
    pulsing = !pulsing;
    pulseBtn.textContent = pulsing ? "Stop Pulse" : "Pulse Squares";
};

vertexBtn.onclick = () => {
    vertexRays = !vertexRays;
    vertexBtn.textContent = vertexRays ? "Hide Rays" : "Vertex Rays";
};
</script>

</body>
</html>
